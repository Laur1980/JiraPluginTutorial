define("jira/setup/init-setup-page",["jira/ajs/select/single-select","jira/ajs/list/item-descriptor","underscore","jquery"],function(e,a,t,n){"use strict";function i(){function i(){var e=n("#jira-setupwizard-email-notifications-disabled").is(":checked"),a={emailProvider:"none"};if(e)return a;var t=function(){var e=n("select[name='serviceProvider']").val();return n.isArray(e)?e[0]:e}();if(n.extend(a,{emailProvider:t}),"custom"===t){var i=n("#jira-setupwizard-email-notifications-smtp").is(":checked");if(i){var s=function(){var e=n("input[name='serverName']").val();return-1!==["mail","smtp","exchange"].indexOf(e)?e:""}(),r=function(){var e=n("input[name='serverName']").val().toLowerCase(),a=e.indexOf(".");return e=-1!==a?e.substr(0,a):e,-1!==["mail","smtp","exchange","mx","localhost"].indexOf(e)?e:""}();n.extend(a,{emailHostname:s,emailHostnameExt:r,emailPort:n("input[name='port']").val(),emailProtocol:function(){var e=n("select[name='protocol']").val();return n.isArray(e)?e[0]:e}()})}n.extend(a,{emailIsSMTP:i})}return a}function r(){"false"==n("input[name=changingLanguage]").val()&&"testconnection"==n("input[name=testingConnection]").val()||"true"==n("input[name=testingMailConnection]").val()?n("#test-connection-throbber").removeClass("hidden"):"false"!==n("input[name=changingLanguage]").val()&&"false"!==n("input[name=testingMailConnection]").val()||n("#submit-throbber").removeClass("hidden"),n(".throbber-message").removeClass("hidden")}function o(){var e=n("select[name=databaseType]").val();""!=e&&(n(".setup-fields").addClass("hidden"),n(".db-option-"+e).removeClass("hidden"))}function l(){var e=n("select[name=databaseType]"),a=e.parent().find(".description").empty(),t=e.val();""!=t&&e.parent().find(".descriptions ."+t).clone().appendTo(a)}var c=require("jira/setup/setup-tracker");if(c.insert(),!n("body").hasClass("jira-setup-database-page")){n("#jira-setupwizard").submit(function(e){var a=["#jira-setupwizard-submit","#jira-setupwizard-test-connection","#jira-setupwizard-test-mailserver-connection","#jira-setupwizard-submit-instant","#jira-setupwizard-submit-classic"],t=n("body").hasClass("jira-setup-page-mail-notifications");if(t&&!n(this).data("intercepted"))e.preventDefault(),n(this).data("intercepted",!0),setTimeout(function(){c.sendMailConfigurationEvent(i()).always(function(){n("#jira-setupwizard").submit()})},0);else if(t)return!0;n(a.join(", ")).attr("disabled","disabled");var s=n("#jira-setupwizard-server-language");s.length>0&&s.attr("disabled","disabled"),n("input[name=nextStep]").val("true"),r()}),n("input[name=databaseOption]").change(function(){var e="EXTERNAL"==n(this).val(),a=n("#jira-setupwizard-test-connection"),t=n("#setup-db-external");e?(t.removeClass("hidden"),a.removeClass("hidden")):(t.addClass("hidden"),a.addClass("hidden"))});var d={ports:{},schemas:{}};d.ports.postgres72="5432",d.schemas.postgres72="public",d.ports.mysql="3306",d.schemas.mysql="",d.ports.oracle10g="1521",d.schemas.oracle10g="",d.ports.mssql="1433",d.schemas.mssql="dbo","EXTERNAL"==n("input[name=databaseOption]:checked").val()&&n("#setup-db-external, #jira-setupwizard-test-connection").removeClass("hidden"),o(),l(),n("select[name=databaseType]").change(function(){var e=n(this).val(),a=n("input[name='jdbcPort']"),t=n("input[name='schemaName']");a.val(d.ports[e]),t.val(d.schemas[e]),o(),l()}),n("#jira-setupwizard-test-connection").click(function(){n("input[name=changingLanguage]").val("false"),n("input[name=testingConnection]").val("true"),n("#jira-setupwizard").submit()}),n("#jira-setupwizard-server-language").change(function(){var e=n(this).val();n("input[name=language]").val(e),n("input[name=changingLanguage]").val("true"),n("#jira-setupwizard").submit()}),n("#fetchLicense").click(function(){var e=n("#jira-setupwizard").serializeArray(),a=n(this).attr("data-url");n.post(a,e,function(){return!1})});var u=n("#enableAnalytics");if(1==u.length){var p=n(".analytics-yes-please"),m=n(".analytics-no-thanks"),v=function(e){return function(a){a.preventDefault(),u.val(e),n(this).closest("form").submit()}};p.click(v(!0)),m.click(v(!1)),t.defer(function(){p.blur()})}var f=n('input[name="analytics-enabled"]');if(f.length>0&&"true"===f.val()){var h=document.createElement("script");h.type="text/javascript",h.async=!0,h.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(h,g),s.push(["_setAccount","UA-20272869-4"]),s.push(["_setDomainName","none"]),s.push(["_setDetectTitle",!1]);var b="true"===f.val()?1:0;s.push(["_trackEvent","btf.analytics",b?"enable":"disable","JIRA",0])}n("#test-connection-messages").hide(),n("input[name=noemail]").change(function(){var e="false"==n(this).val(),a=n("#setup-notification-fields"),t=n("#jira-setupwizard-test-mailserver-connection");e?(a.removeClass("hidden"),t.removeClass("hidden")):(a.addClass("hidden"),t.addClass("hidden"))}),"false"==n("input[name=noemail]:checked").val()&&n("#setup-notification-fields, #jira-setupwizard-test-mailserver-connection").removeClass("hidden"),n("input[name=mailservertype]").change(function(){var e=n(this).val(),a=n(".setup-fields");"smtp"==e?(a.addClass("hidden"),n("#email-notifications-smtp-fields").removeClass("hidden")):(a.addClass("hidden"),n("#email-notifications-jndi-fields").removeClass("hidden"))});var w=n("input[name=mailservertype]:checked");"smtp"==w.val()?(n(".setup-fields").addClass("hidden"),n("#email-notifications-smtp-fields").removeClass("hidden")):"jndi"==w.val()&&(n(".setup-fields").addClass("hidden"),n("#email-notifications-jndi-fields").removeClass("hidden")),n("#jira-setupwizard-test-mailserver-connection").click(function(){n("input[name=testingMailConnection]").val("true"),n("#jira-setupwizard").attr("action","VerifySmtpServerConnection!setup.jspa").submit()}),n("#reimport").click(function(e){e.preventDefault(),n("input[name=useDefaultPaths]").val("true"),n("#jira-setupwizard").submit()});n("#acknowledgeDowngradeError").click(function(e){e.preventDefault(),n("#acknowledgeDowngradeError").parent().parent().fadeOut(),n("input[name=downgradeAnyway]").val("true")});var j=n("select[name=serviceProvider]");if(j.length>0){var C=new a({value:"smtps",label:"SECURE_SMTP"}),y={"gmail-smtp":{protocol:C,serverName:"smtp.gmail.com",port:"465"},"yahooplus-smtp":{protocol:C,serverName:"plus.smtp.mail.yahoo.com",port:"465"}};new e({element:j});var z=new e({element:n("select[name=protocol]")});j.change(function(e){return function(){var a=n(this).val(),t=!1,i=n("input[name=serverName]"),s=n("input[name=port]"),r=n("input[name=tlsRequired]"),o=y[a];o?(e.setSelection(o.protocol),i.val(o.serverName),s.val(o.port)):t=!0,e.$container.parent(".field-group").toggle(t),i.parent(".field-group").toggle(t),s.parent(".field-group").toggle(t),r&&r.parent(".field-group").toggle(t)}}(z)).change()}else n(".select").each(function(){new e({element:this})})}}var s=window._gaq=window._gaq||[];return i});