AJS.test.require(["jira.webresources:avatar-picker"],function(){function a(){var a=new d({restQueryUrl:"blah",restCreateTempUrl:"blah",restUpdateTempUrl:"blah",defaultAvatarId:1e3});return new s({store:a,defaultAvatarId:1e3,avatarSrcBaseUrl:"/secure/projectavatar"})}function e(a){var e=r.ajax;r.ajax=function(t){t.success&&t.success(a,"success",{status:200}),t.complete&&t.complete("success",{status:200}),r.ajax=e}}function t(a){var e=r.ajax;r.ajax=function(t){t.error&&t.error({status:a||500},"error"),t.complete&&t.complete("error",{status:a||500}),r.ajax=e}}var r=require("jquery"),s=require("jira/ajs/avatarpicker/avatar-manager"),d=require("jira/ajs/avatarpicker/avatar-store"),i=require("jira/ajs/avatarpicker/avatar-factory"),u=require("jira/ajs/avatarpicker/avatar/sizes"),v=require("jira/ajs/avatarpicker/avatar");test("getById",function(){var t=a();equal(t.getById(1e3),void 0,"Expected undefined if no match"),e({id:1e3}),t.add(i.createCustomAvatar({id:1e3}));var r=t.getById(1e3);ok(r instanceof v,"Expected instance of JIRA.Avatar"),equal(r.getId(),1e3,"Expected avatar to have id [1000]")}),test("destroy",function(){var r=a();e({id:1e3}),r.add(i.createCustomAvatar({id:1e3}));var s=r.getById(1e3);e({id:1e3}),r.destroy(s),equal(r.getById(1e3),void 0,"Expected avatar to be destroyed"),e({id:1e3}),r.add(i.createCustomAvatar({id:1e3})),s=r.getById(1e3),t(),r.destroy(s),ok(r.getById(1e3)instanceof v,"Expected avatar to not be detroyed in case of server error")}),test("getAllSystemAvatars",function(){var t=a();e({id:1001}),t.add(i.createSystemAvatar({id:1001})),e({id:1002}),t.add(i.createSystemAvatar({id:1002})),e({id:1003}),t.add(i.createSystemAvatar({id:1003})),e({id:1004}),t.add(i.createSystemAvatar({id:1004})),e({id:1005}),t.add(i.createCustomAvatar({id:1005}));var r=t.getAllSystemAvatars();equal(r[0].getId(),1001),equal(r[1].getId(),1002),equal(r[2].getId(),1003),equal(r[3].getId(),1004),equal(r[4],void 0)}),test("getAllCustomAvatars",function(){var t=a();e({id:1001}),t.add(i.createCustomAvatar({id:1001})),e({id:1002}),t.add(i.createCustomAvatar({id:1002})),e({id:1003}),t.add(i.createCustomAvatar({id:1003})),e({id:1004}),t.add(i.createCustomAvatar({id:1004})),e({id:1005}),t.add(i.createSystemAvatar({id:1005}));var r=t.getAllCustomAvatars();equal(r[0].getId(),1001),equal(r[1].getId(),1002),equal(r[2].getId(),1003),equal(r[3].getId(),1004),equal(r[4],void 0)}),test("getAllAvatars",function(){var t=a();e({id:1001}),t.add(i.createCustomAvatar({id:1001})),e({id:1002}),t.add(i.createSystemAvatar({id:1002}));var r=t.getAllAvatars();equal(r.custom.length,1),equal(r.system.length,1),equal(r.custom[0].getId(),1001),equal(r.system[0].getId(),1002)}),test("refreshStore",function(){function t(){e({system:[{id:1e3,isSystemAvatar:!0},{id:1001,isSystemAvatar:!0},{id:1002,isSystemAvatar:!0}],custom:[{id:1003},{id:1004}]}),r.refreshStore()}var r=a();t();var s=r.getAllSystemAvatars(),d=r.getAllCustomAvatars();equal(s.length,3),equal(s[0].getId(),1e3),equal(s[1].getId(),1001),equal(s[2].getId(),1002),equal(d.length,2),equal(d[0].getId(),1003),equal(d[1].getId(),1004),t(),s=r.getAllSystemAvatars(),d=r.getAllCustomAvatars(),equal(s.length,3),equal(d.length,2)}),test("getAvatarSrc",function(){var e={"16x16":"http://localhost:8090/jira/secure/useravatar?size=xsmall&avatarId=10041","24x24":"http://localhost:8090/jira/secure/useravatar?size=small&avatarId=10041","32x32":"http://localhost:8090/jira/secure/useravatar?size=medium&avatarId=10041","48x48":"http://localhost:8090/jira/secure/useravatar?avatarId=10041"},t=a(),r=i.createSystemAvatar({id:1002,urls:e}),s=i.createSystemAvatar({id:999,urls:e});equal(t.getAvatarSrc(r,u.SMALL),e["16x16"]),equal(t.getAvatarSrc(s,u.MEDIUM),e["32x32"]),equal(t.getAvatarSrc(s,u.LARGE),e["48x48"])})});