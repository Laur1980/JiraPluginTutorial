define("jira/ajs/layer/inline-layer",["jira/ajs/layer/layer-constants","jira/ajs/layer/layer-interactions","jira/ajs/control","jira/ajs/layer/hide-reasons","jira/ajs/layer/inline-layer/options-descriptor","jira/ajs/contentretriever/content-retriever","jira/util/events","jquery"],function(t,i,e,s,n,r,o,h){var a=e.extend({CLASS_SIGNATURE:"AJS_InlineLayer",SCROLL_HIDE_EVENT:"scroll.hide-dropdown",init:function(t){var i=this;if(this.options=t instanceof n?t:new n(t),this.offsetTarget(this.options.offsetTarget()),this.contentRetriever=this.options.contentRetriever(),h.extend(this,this.options.positioningController()),!(this.contentRetriever instanceof r))throw new Error("InlineLayer: Failed construction, Content retriever does not implement interface [AJS.ContentRetrieverInterface]");this.contentRetriever.startingRequest(function(){i._showLoading()}),this.contentRetriever.finishedRequest(function(){i._hideLoading()}),this.contentRetriever.failedRequest&&this.contentRetriever.failedRequest(function(){i.onerror()}),this.$layer=this._render("layer",this.options.alignment())},content:function(t){var i=this;if(!h.isFunction(t))return this.$content;this.contentRetriever.content(function(e){i.$content=e.removeClass("hidden"),t.call(i)})},offsetTarget:function(){var t=this.options.offsetTarget();return h.isFunction(t)&&(t=t()),t},contentChange:function(t){var i=this;h.isFunction(t)?(this.contentChangeCallback||(this.contentChangeCallback=[]),this.contentChangeCallback.push(t)):t||(this.trigger("contentChanged",[this]),this.setWidth(this.options.width()),this.setPosition(),this.contentChangeCallback&&h.each(this.contentChangeCallback,function(t,e){e(i)}))},onhide:function(t){var i=this;h.isFunction(t)?(this.hideCallback||(this.hideCallback=[]),this.hideCallback.push(t)):!t&&this.hideCallback&&h.each(this.hideCallback,function(t,e){e(i)})},onerror:function(t){var i=this;h.isFunction(t)?(this.errorCallback||(this.errorCallback=[]),this.errorCallback.push(t)):!t&&this.errorCallback&&h.each(this.errorCallback,function(t,e){e(i)})},layer:function(t){if(!t)return this.$layer;this.$layer=t},placeholder:function(t){if(!t)return this.$placeholder;this._throwReadOnlyError("placeholder")},isVisible:function(t){return void 0!==t&&this._throwReadOnlyError("visible"),this.visible},scrollableContainer:function(t){return t&&this._throwReadOnlyError("scrollableContainer"),this.$scrollableContainer},isInitialized:function(t){return t&&this._throwReadOnlyError("initialized"),this.initialized},hide:function(t,i){var e,s=i&&i.target;if(!this.isVisible())return!1;if(e=h.Event(a.EVENTS.beforeHide),this.trigger(e,[this.layer(),t,this.options.id,s]),o.trigger(e,[this.layer(),t,this.options.id,s]),!e.isDefaultPrevented()){this.visible=!1,this._makeInactiveAndHideLayer();var n=this;setTimeout(function(){n.appendToPlaceholder()},0),this.layer().attr("aria-hidden","true"),this._unbindEvents(),this.onhide(),this.trigger("hideLayer",[this]),h(document).trigger("hideLayer",[this.CLASS_SIGNATURE,this]),this.trigger(a.EVENTS.hide,[this.layer(),t,this.options.id]),o.trigger(a.EVENTS.hide,[this.layer(),t,this.options.id]),a.current=null}},_makeInactiveAndHideLayer:function(){this.layer().removeClass(t.ACTIVE_CLASS).hide(),this.offsetTarget().removeClass(t.ACTIVE_CLASS)},refreshContent:function(t){var i=this;this.content(function(){0===this.layer().has(this.content()).length&&this.layer().html(this.content()),h.isFunction(t)&&t.call(i),this.contentChange()})},show:function(){var t,i=this;this.isVisible()||(t=h.Event(a.EVENTS.beforeShow),this.trigger(t,[this.layer(),this.options.id]),o.trigger(t,[this.layer(),this.options.id]),t.isDefaultPrevented()||(this.isInitialized()?!1===this.contentRetriever.cache()?this.refreshContent(function(){i._showContent()}):i._showContent():this._lazyInit(function(){i._showContent()})))},_showContent:function(){this.offsetTarget().is(":visible")?this._show():this._makeInactiveAndHideLayer()},toggle:function(t){null==t&&(t=!this.isVisible()),t?this.show():this.hide(s.toggle)},setPosition:function(){var i,e=h(window);if(this.isInitialized()&&this.offsetTarget()&&0!==this.offsetTarget().length){var s=this.offsetTarget().get(0).getBoundingClientRect(),n=this.layer().width(),r=s.left+n<e.width()+e.scrollLeft(),o=s.left+s.width-n>e.scrollLeft();if(this.options.alignment()===t.RIGHT?i=o||!r?this.right():this.left():this.options.alignment()===t.LEFT?i=r||!o?this.left():this.right():this.options.alignment()===t.INTELLIGENT_GUESS&&(i=s.left+s.width/2>e.width()/2?this.right():this.left()),this.trigger("setLayerPosition",[i,this]),this.options.properties.setMaxHeightToWindow||!1!==this.options.properties.setMaxHeightToWindow&&h(".aui-blanket").is(":visible")){var a=e.scrollLeft();a>0&&(i.left-=a);var l,c=this.fixedParent();l=c.size()?0:e.scrollTop(),i.maxHeight=e.height()-i.top+l-this.options.cushion()}i.minHeight=this.options.properties.minHeight,this.layer().css(i)}},setOverflowAndHeight:function(){this.options.properties.maxInlineResultsDisplayed&&this.layer().addClass("limited")},fixedParent:function(){return this.offsetTarget().parents().filter(function(){return"fixed"===h(this).css("position")})},setWidth:function(t){this.layer().width(t)},_lazyInit:function(i){this.initializing||(this.initializing=!0,this.refreshContent(function(){var e=this;this.initializing=!1,this.initialized=!0,this.layer().insertAfter(this.offsetTarget()),this._supportsBoxShadow()&&this.layer().addClass(t.BOX_SHADOW_CLASS),this.$placeholder=h("<div class='ajs-layer-placeholder' />").insertAfter(this.offsetTarget()),this.$scrollableContainer=this.offsetTarget().closest(this.options.hideOnScroll()),this.rebuilt(function(t){e.layer(t)}),i()}))},_show:function(){a.current&&a.current.hide(),this.visible=!0,this.content().show(),this.appendToBody(),this.layer().addClass(t.ACTIVE_CLASS),this.offsetTarget().addClass(t.ACTIVE_CLASS),this.layer().show(),this.layer().attr("aria-hidden","false"),this.setWidth(this.options.width()),this.setPosition(),this.setOverflowAndHeight(),this._bindEvents(),AJS.dim.dim||this.scrollTo(),a.current=this,this.trigger("showLayer",[this]),h(document).trigger("showLayer",[this.CLASS_SIGNATURE,this]),this.trigger(a.EVENTS.show,[this.layer(),this.options.id]),o.trigger(a.EVENTS.show,[this.layer(),this.options.id])},_hideLoading:function(){this.$layer.removeClass(t.LOADING_CLASS),this.offsetTarget().removeClass(t.LOADING_CLASS)},_showLoading:function(){this.$layer.addClass(t.LOADING_CLASS),this.offsetTarget().addClass(t.LOADING_CLASS)},_unbindEvents:function(){this.$scrollableContainer.unbind(this.SCROLL_HIDE_EVENT),this._unassignCustomEvents(),this._unassignEvents("container",document),this._unassignEvents("win",window)},_bindEvents:function(){var t=this;this.$scrollableContainer.one(this.SCROLL_HIDE_EVENT,function(){t.hide()}),this._assignCustomEvents(),this._assignEvents("container",document),this._assignEvents("win",window)},_assignCustomEvents:function(){var t=this.options.customEvents();if(t){this._unassignCustomEvents();for(var i in t)for(var e in t[i])h(i).on(e,this._getCustomEventsDispatcher(i,e,t))}},_unassignCustomEvents:function(){var t=this.options.customEvents();if(t)for(var i in t)for(var e in t[i])h(i).off(e,this._getCustomEventsDispatcher(i,e,t))},_getCustomEventsDispatcher:function(t,i,e){var s="custom/"+t+"/"+i;if(this._dispatchers||(this._dispatchers={}),!this._dispatchers[s]){var n=this,r=e[t][i];this._dispatchers[s]=function(t){return r.call(n,t,h(this))}}return this._dispatchers[s]},_validateClickToClose:function(t){return t.target!==this.offsetTarget()[0]&&(t.target!==this.layer()[0]&&(!(this.offsetTarget().has(t.target).length>0)&&!(this.layer().has(t.target).length>0)))},keys:{Esc:function(t){this.hide(s.escPressed,t)}},_events:{container:{"aui:keydown":function(t){this._handleKeyEvent(t)},click:function(t){this._validateClickToClose(t)&&this.hide(s.clickOutside,t)}},win:{resize:function(){this.setPosition()},scroll:function(){this.setPosition()}}},_renders:{layer:function(){return h("<div />").addClass("ajs-layer").addClass(this.options.styleClass())}}});return a.EVENTS={beforeHide:"InlineLayer.beforeHide",hide:"InlineLayer.hide",beforeShow:"InlineLayer.beforeShow",show:"InlineLayer.show"},i.preventInputBlur(a),i.preventDialogHide(a),i.hideBeforeDialogShown(a),a});