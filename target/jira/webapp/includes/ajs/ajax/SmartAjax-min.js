define("jira/ajs/ajax/smart-ajax",["jira/util/formatter","jira/util/logger","jira/util/data/meta","jquery"],function(t,r,a,e){function n(t,a,e){var n=a?"["+a+"] ":" ";r.log("ajax"+n+t+" : "+e)}function o(t,r){try{return t()}catch(t){return r}}function s(){var t=a.get("remote-user");return void 0===t?"undefined":t}function u(r,a){return r.statusText==m.SmartAjaxResult.TIMEOUT?t.I18n.getText("common.forms.ajax.timeout"):401===r.status?t.I18n.getText("common.forms.ajax.unauthorised.alert"):r.hasData?t.I18n.getText("common.forms.ajax.servererror"):t.I18n.getText("common.forms.ajax.commserror")}function i(r,a){var e='<div class="dialog-error"><p>'+r+"</p><p>"+t.I18n.getText("common.forms.ajax.error.dialog")+"</p></div>";return a||(e="<h1>"+t.I18n.getText("common.forms.ajax.error.dialog.heading")+"</h1>"+e),c(e)}function c(t){var r=e('<div class="ajaxerror"/>');return r.append(t),r}var m={};return m.SmartAjaxResult=function(t,r,a,e,n,s){var u=o(function(){return t.status},0),i={successful:n,status:u,statusText:a,errorThrown:s,readyState:t.readyState,hasData:null!=e&&e.length>0,data:e,xhr:t,aborted:t.aborted,requestId:r,validationError:!(400!==t.status||!e||!e.errors)};return i.toString=function(){return"{\nsuccessful  : "+this.successful+",\nstatus      : "+this.status+",\nstatusText  : "+this.statusText+",\nhasData     : "+this.hasData+",\nreadyState  : "+this.readyState+",\nrequestId   : "+this.requestId+",\naborted     : "+this.aborted+",\n}"},i},m.SmartAjaxResult.ERROR="error",m.SmartAjaxResult.TIMEOUT="timeout",m.SmartAjaxResult.NOTMODIFIED="notmodified",m.SmartAjaxResult.PARSEERROR="parseerror",m.makeRequest=function(t){var r={},a=function(a,s,u,i){if(!i){var c=o(function(){return a.responseText},"");i=r=new m.SmartAjaxResult(a,j,s,c,!1,u)}n("error",i.requestId,i),e.isFunction(t.error)&&t.error(a,s,u,i)},u=function(n,o,s){if(s.status<100)return r=new m.SmartAjaxResult(s,j,m.SmartAjaxResult.ERROR,"",!1),void a(s,m.SmartAjaxResult.ERROR,void 0,r);r=new m.SmartAjaxResult(s,j,o,n,!0),e.isFunction(t.success)&&t.success(n,o,s,r)},i=function(a,n){e.isFunction(t.complete)&&t.complete(a,n,r)},c={jqueryAjaxFn:e.ajax,headers:{"X-AUSERNAME":encodeURIComponent(s())}},l=e.extend(!0,{},c,t);l.error=a,l.success=u,l.complete=i;var x=l.jqueryAjaxFn.apply(l,[l]),j=function(){var t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),a=t.getTime()-r.getTime();return Math.max(Math.floor(a),1)}();try{x.abort=function(t){return function(){if(n("aborted",j,""),x.aborted=!0,e.isFunction(t))try{t.apply(x,arguments)}catch(t){}}}(x.abort)}catch(t){}return x},m.buildDialogErrorContent=function(t,r){var a=Math.floor(t.status/100);return t.hasData&&4!==a?c(AJS.extractBodyFromResponse(t.data)):i(u(t),r)},m.buildSimpleErrorContent=function(t,r){return u(t,r||{})},m}),AJS.namespace("JIRA.SmartAjax",null,require("jira/ajs/ajax/smart-ajax")),AJS.namespace("jira.ajax",null,require("jira/ajs/ajax/smart-ajax"));