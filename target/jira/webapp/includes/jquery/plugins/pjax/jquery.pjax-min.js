!function(t){t.fn.pjax=function(e,n){if(n?n.container=e:n=t.isPlainObject(e)?e:{container:e},n.container&&"string"!=typeof n.container)throw"pjax container must be a string selector!";return this.live("click",function(e){if(e.which>1||e.metaKey)return!0;var r={url:this.href,container:t(this).attr("data-pjax"),clickedElement:t(this),fragment:null};t.pjax(t.extend({},r,n)),e.preventDefault()})},t.pjax=function(e){var n=t(e.container),r=e.success||t.noop;if(delete e.success,"string"!=typeof e.container)throw"pjax container must be a string selector!";var a={timeout:650,push:!0,replace:!1,data:{_pjax:!0},type:"GET",dataType:"html",beforeSend:function(t){n.trigger("start.pjax"),t.setRequestHeader("X-PJAX","true")},error:function(){window.location=e.url},complete:function(){n.trigger("end.pjax")},success:function(a){if(e.fragment){var i=t(a).find(e.fragment);if(!i.length)return window.location=e.url;a=i.children()}else if(!t.trim(a)||/<html/i.test(a))return window.location=e.url;n.html(a);var o=document.title,u=t.trim(n.find("title").remove().text());u&&(document.title=u);var c={pjax:e.container,fragment:e.fragment,timeout:e.timeout},l=t.param(e.data);"_pjax=true"!=l&&(c.url=e.url+(/\?/.test(e.url)?"&":"?")+l),e.replace?window.history.replaceState(c,document.title,e.url):e.push&&(t.pjax.active||(window.history.replaceState(t.extend({},c,{url:null}),o),t.pjax.active=!0),window.history.pushState(c,document.title,e.url)),(e.replace||e.push)&&window._gaq&&_gaq.push(["_trackPageview"]);var p=window.location.hash.toString();""!==p&&(window.location.href=p),r.apply(this,arguments)}};e=t.extend(!0,{},a,e),t.isFunction(e.url)&&(e.url=e.url());var i=t.pjax.xhr;return i&&i.readyState<4&&(i.onreadystatechange=t.noop,i.abort()),t.pjax.xhr=t.ajax(e),t(document).trigger("pjax",t.pjax.xhr,e),t.pjax.xhr};var e="state"in window.history,n=location.href;t(window).bind("popstate",function(r){var a=!e&&location.href==n;if(e=!0,!a){var i=r.state;if(i&&i.pjax){var o=i.pjax;t(o+"").length?t.pjax({url:i.url||location.href,fragment:i.fragment,container:o,push:!1,timeout:i.timeout}):window.location=location.href}}}),t.inArray("state",t.event.props)<0&&t.event.props.push("state"),t.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/(iPod|iPhone|iPad|WebApps\/.+CFNetwork)/),t.support.pjax||(t.pjax=function(e){window.location=t.isFunction(e.url)?e.url():e.url},t.fn.pjax=function(){return this})}(jQuery);