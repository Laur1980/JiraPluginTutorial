define("jira/searchers/datesearcher/date-types",["require"],function(e){"use strict";var t=e("jquery"),a=e("backbone"),r=e("underscore"),n=e("jira/libs/calendar"),s=["js-dp-type-toggle","js-val","js-measurement","js-clause","js-start-date","js-end-date","js-start-range","js-end-range"],i=function(e,a){var n=t("<div></div>").html(e).contents(),i=[];return n.each(function(e,n){var d=t(n),l=t("<div/>").html(n).html();r.contains(s,d.attr("class"))?i.push(l):(l=l.replace(/^\s+|\s+$/g,"&nbsp;"),i.push("<label for='"+a+"'>"+l+"</label>"))}),i.join("")},d=function(e){var t=e.radioKey+"Radio",a=e.$el.html(i(e.rawTemplate,t));return a.find(":not(.js-dp-type-toggle):not(select):input").mousedown(function(){var e=a.find("label");e.length>0&&e[0].click()}),a},l=a.View.extend({className:"field-group",attributes:{"data-date-type":"nowOverdue"},template:JIRA.Templates.DateSearcher.nowOverdue,getValues:function(){return{to:0}},updateFromValues:function(e){if(!e.from&&"0"===e.to)return!0},render:function(){return this.$el.html(this.template())}}),o=a.View.extend({className:"field-group",attributes:{"data-date-type":"withinTheLast"},template:JIRA.Templates.DateSearcher.withinTheLast,getValues:function(){var e=this.$(".js-val").val();if(e)return{from:"-"+e+this.$el.find(".js-measurement").val()}},updateFromValues:function(e){if(!e.to&&e.from&&"-"===e.from.charAt(0)){var t=this.model.parseRelativeStr(e.from);return this.$(".js-val").val(t.val.slice(1)),t.measurement&&this.$(".js-measurement").val(t.measurement),!0}},render:function(){return d({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}}),u=a.View.extend({className:"field-group",attributes:{"data-date-type":"moreThan"},template:JIRA.Templates.DateSearcher.moreThan,getValues:function(){var e=this.$(".js-val").val();if(e)return{to:"-"+e+this.$el.find(".js-measurement").val()}},updateFromValues:function(e){if(!e.from&&e.to&&"-"===e.to.charAt(0)){var t=this.model.parseRelativeStr(e.to);return this.$(".js-val").val(t.val.slice(1)),t.measurement&&this.$(".js-measurement").val(t.measurement),!0}},render:function(){return d({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}}),h=u.extend({className:"field-group",template:JIRA.Templates.DateSearcher.dueMoreThan}),c=a.View.extend({className:"field-group",attributes:{"data-date-type":"dueInNext"},template:JIRA.Templates.DateSearcher.dueInNext,getValues:function(){var e=this.$el.find(".js-val").val();if(e)return{from:"andNot"===this.$el.find(".js-clause").val()?"0":null,to:e+this.$(".js-measurement").val()}},updateFromValues:function(e){if((!e.from||"0"===e.from)&&e.to){var t=this.model.parseRelativeStr(e.to),a="0"===e.from?"andNot":"orIs";return this.$(".js-val").val(t.val),this.$(".js-clause").val(a),t.measurement&&this.$(".js-measurement").val(t.measurement),!0}},render:function(){return d({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}});return{DatesBetween:a.View.extend({className:"field-group",attributes:{"data-date-type":"dateBetween"},template:JIRA.Templates.DateSearcher.dateBetween,getValues:function(){return{startDate:this.$el.find(".js-start-date").val(),endDate:this.$el.find(".js-end-date").val()}},updateFromValues:function(e){if(e.startDate||e.endDate)return this.$el.find(".js-start-date").val(e.startDate),this.$el.find(".js-end-date").val(e.endDate),!0},bindCalendar:function(e,t){var a=this.$el.find("."+t)[0],s=this.$el.find("."+e)[0],i=r.extend({},this.model.calendarConfig,{inputField:s,button:a});n.setup(i)},render:function(){return d({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]}),this.bindCalendar("js-end-date","js-end-date-trigger"),this.bindCalendar("js-start-date","js-start-date-trigger"),this.$el}}),DueInNext:c,DueMoreThan:h,InRange:a.View.extend({className:"field-group",attributes:{"data-date-type":"inRange"},template:JIRA.Templates.DateSearcher.inRange,getValues:function(){return{from:this.$el.find(".js-start-range").val(),to:this.$el.find(".js-end-range").val()}},updateFromValues:function(e){if(e.from||e.to)return this.$el.find(".js-start-range").val(e.from),this.$el.find(".js-end-range").val(e.to),!0},render:function(){return d({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}}),MoreThan:u,NowOverdue:l,WithinTheLast:o}}),define("jira/searchers/datesearcher/date-searcher-model",["require"],function(e){"use strict";var t=e("jira/data/parse-options-from-fieldset");return e("backbone").Model.extend({initialize:function(e){this.from$El=e.$el.find(".js-date-picker-from").hide(),this.to$El=e.$el.find(".js-date-picker-to").hide(),this.startDate$El=e.$el.find(".js-date-picker-start-date").hide(),this.endDate$El=e.$el.find(".js-date-picker-end-date").hide(),this.errors=t(e.$el.find("fieldset.js-date-picker-errors")),this.calendarConfig=t(e.$el.find("fieldset.datepicker-params"))},parseRelativeStr:function(e){var t=e.slice(e.length-1);return{val:e.slice(0,e.length-1),measurement:t}},update:function(e){this.clear(),e&&(void 0!==e.from&&this.from$El.val(e.from),void 0!==e.to&&this.to$El.val(e.to),void 0!==e.startDate&&this.startDate$El.val(e.startDate),void 0!==e.endDate&&this.endDate$El.val(e.endDate))},toJSON:function(){return{from:this.from$El.val(),to:this.to$El.val(),startDate:this.startDate$El.val(),endDate:this.endDate$El.val(),errors:this.errors}},clear:function(){this.from$El.val(""),this.to$El.val(""),this.startDate$El.val(""),this.endDate$El.val("")}})}),define("jira/searchers/datesearcher/date-searcher",["require"],function(e){"use strict";var t=e("jira/searchers/datesearcher/date-searcher-model"),a=e("jquery"),r=e("backbone"),n=e("underscore");return r.View.extend({initialize:function(e){var r=this;this.verb=e.verb,this.model=new t({$el:this.$el}),this.setElement(a("<div />").addClass("js-picker-ui").appendTo(this.$el)),this.views=[];var s=!a.browser.msie||parseInt(a.browser.version,10)<10;n.each(e.dateTypes,function(e){var t=new e({model:r.model});r.views.push(t),s?t.$el.delegate(":text","input",function(){r.update(t)}):(t.$el.delegate(":text","keydown",function(){var e=a(this),n=e.val();e.one("keyup",function(){e.val()!==n&&r.update(t)})}),t.$el.delegate(":text","change",function(){r.update(t)})),t.$el.delegate(":radio,select,input","change",function(){r.update(t)}).delegate(".aui-iconfont-calendar","click",function(){r.update(t)})})},update:function(e){this.model.update(e.getValues()),n.each(this.views,function(t){t===e?t.$(":radio").prop("checked",!0):t.$(":radio").prop("checked",!1)})},render:function(){var e=this,t=this.model.toJSON();n.each(this.views,function(t){e.$el.append(t.render(e.verb))}),a.each(this.views,function(r,n){if(this.updateFromValues(t))return e.update(this),t.errors&&a.each(t.errors,function(e,t){return a("<div />").addClass("error").text(t).appendTo(n.$el),!1}),!1}),window.setTimeout(function(){e.$el.find(":radio:checked").focus()},30)}})}),define("jira/searchers/datesearcher/date-searcher-factory",["require","exports"],function(e,t){"use strict";var a=e("jira/searchers/datesearcher/date-types"),r=e("jira/searchers/datesearcher/date-searcher");t.createDueDateSearcher=function(e){return new r({el:e,dateTypes:[a.NowOverdue,a.DueMoreThan,a.DueInNext,a.DatesBetween,a.InRange]}).render()},t.createResolvedDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()},t.createCreatedDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()},t.createUpdatedDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()},t.createCustomDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()}});