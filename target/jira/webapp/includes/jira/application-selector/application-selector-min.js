define("jira/admin/application-selector",["jira/admin/application-selector/application","jira/admin/application-selector/application-critical","jira/admin/application-selector/application-selectable","jira/skate","marionette","underscore","jquery"],function(e,i,t,n,s,c,a){"use strict";return s.CollectionView.extend({itemEvents:c.object([[e.TOGGLE_EVENT,function(e,i){this.numberOfAppsSelectedExcludingCore()?this._makeCoreIncluded():this.hasCore()&&this.core!==i&&this._makeCoreAvailable(),this.selectEffectiveApplications()}]]),initialize:function(s){this.disableEffectiveAccess=s.disableEffectiveAccess,this.disableUndefinedWarningDisplaying=s.disableUndefinedWarningDisplaying;var c=a(s.el).find(".application");c.length&&(n.init(s.el),c.each(function(e,n){var s,c=a(n),l=c.data("indeterminate"),r={el:n.parentNode,disableUndefinedWarningDisplaying:this.disableUndefinedWarningDisplaying};s=c.hasClass("application-warning")?new i(r):new t(r),l&&s.setIndeterminate(!0,{silent:"effective"!==l}),this.addChildViewEventForwarding(s),this.children.add(s,s.getApplicationKey())}.bind(this)),this.core=this.children.findByCustom("jira-core"),this.hasCore()&&(this.listenTo(this.core,e.TOGGLE_EVENT,function(e){e.manual&&(this.coreRemainChecked=this.core.isSelected())}),this.coreRemainDisabled=this.core.isDisabled(),this.coreRemainChecked=this.core.isSelected()),this.numberOfAppsSelectedExcludingCore()>0&&this._makeCoreIncluded(),this.selectEffectiveApplications())},disableAllApplications:function(){this.children.each(function(e){e.setDisabled(!0)})},selectApplicationsBasedOnURL:function(e){var i=this._getApplicationKeysToPreselectFromURL(e);i.length&&(this.deselectAll(),i.forEach(function(e){var i=this.getByKey(e);i&&!i.isDisabled()&&i.setSelected(!0)}.bind(this))),this.selectEffectiveApplications()},selectEffectiveApplications:function(){if(!this.disableEffectiveAccess){var e=c.flatten(this.children.toArray().filter(function(e){return e.isSelected()&&!e.isDisabled()}).map(function(e){return e.getEffective()})).map(this.getByKey,this);this.children.each(function(i){!i.isSelected()&&e.indexOf(i)>=0?i.setIndeterminate(!0):i.setIndeterminate(!1)},this)}},_getApplicationKeysToPreselectFromURL:function(e){var i=[];e=e||location.search;var t=e.split("?")[1];if(t){t.split("&").forEach(function(e){var t=e.split("=");"application"===t[0]&&i.push(t[1])}.bind(this))}return i},numberOfAppsSelectedExcludingCore:function(){var e=0,i=this;return this.children.each(function(t){i.hasCore()&&t!==i.core&&(t.isSelected()||t.isIndeterminateButNotEffective())&&(e+=1)}),e},deselectAll:function(){this.getAll().each(function(e){e.setSelected(!1)})},getAll:function(){return this.children},getByKey:function(e){return this.children.findByCustom(e)},hasCore:function(){return!!this.core},_makeCoreIncluded:function(){this.hasCore()&&(this.core.setDisabled(!0),this.core.setSelected(!0))},_makeCoreAvailable:function(){this.hasCore()&&(this.coreRemainDisabled||this.core.setDisabled(!1),this.coreRemainChecked||this.core.setSelected(!1))}})});