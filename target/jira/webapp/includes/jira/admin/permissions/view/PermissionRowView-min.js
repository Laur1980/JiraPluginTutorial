define("jira/project/permissions/permissionrowview",["marionette","jquery","underscore","jira/util/logger","jira/util/formatter","jira/analytics","jira/flag","wrm/context-path","jira/project/permissions/grantsview"],function(e,t,i,n,s,a,o,d,r){"use strict";return e.ItemView.extend({tagName:"tr",template:JIRA.Templates.ProjectPermissions.permissionRow,ui:{grants:".grants",extToggle:"input.toggle"},events:{"click .add-trigger":"openAddDialog","click .delete-trigger":"openDeleteDialog","change @ui.extToggle":"toggleExtendedPermission"},initialize:function(e){this.readOnly=e.readOnly,this.extendedFeedbackFlag=void 0},onRender:function(){this.ui.grants.append(new r({grants:this.model.get("grants")}).render().el)},serializeData:function(){return i.extend({},this.model.toJSON(),{readOnly:this.readOnly})},attributes:function(){return{"data-permission-key":this.model.get("permissionKey")}},openAddDialog:function(e){e.preventDefault(),this.trigger("openAddDialog",this.model.get("permissionKey"))},openDeleteDialog:function(e){e.preventDefault(),this.trigger("openDeleteDialog",this.model)},toggleExtendedPermission:function(e){e.preventDefault();var i=this.ui.extToggle.get(0),r=i.checked,l=this.model.get("extPermission");if(i.busy)return n.warn("Ignoring since the previous request has not been completed yet"),void(i.checked=!r);i.busy=!0,t.ajax({url:d()+l.endpointURI,type:"PUT",data:JSON.stringify(r),contentType:"text/plain",success:function(){i.checked=r,r?a.send({name:"admin.permissions.extendedadmin.optin"}):(a.send({name:"admin.permissions.extendedadmin.optout"}),this._showExtendedPermissionDisableFeedback())}.bind(this),error:function(){i.checked=!r,a.send({name:"admin.permissions.extendedadmin.error"}),r?o.showErrorMsg("",s.I18n.getText("admin.permissions.extendedadmin.feedback.granterror")):o.showErrorMsg("",s.I18n.getText("admin.permissions.extendedadmin.feedback.revokeerror"))},complete:function(){i.busy=!1}})},_closeFeedbackFlag:function(){this.extendedFeedbackFlag&&(this.extendedFeedbackFlag.close(),this.extendedFeedbackFlag=void 0)},_showExtendedPermissionDisableFeedback:function(){this._closeFeedbackFlag();var e=o.showSuccessMsg(s.I18n.getText("admin.permissions.extendedadmin.feedback.flag.title"),JIRA.Templates.ProjectPermissions.optOutFeedbackFlag(),{closeable:!0,close:"manual"}),i=e.querySelector("a.extended-admin-optout-link");this.extendedFeedbackFlag=e,setTimeout(function(){e.close(),this.extendedFeedbackFlag===e&&(this.extendedFeedbackFlag=void 0)}.bind(this),1e4),window.ATL_JQ_PAGE_PROPS={triggerFunction:function(e){i.addEventListener("click",function(t){this._closeFeedbackFlag(),t.preventDefault(),e()}.bind(this))}.bind(this)},t.ajax({url:"https://jira.atlassian.com/s/c0ee7481af1f09efe3d85af9bf8b8d01-T/7fmdi8/73011/b6b48b2829824b869586ac216d119363/2.0.23/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=b206bcb6",type:"get",cache:!0,dataType:"script"})}})});