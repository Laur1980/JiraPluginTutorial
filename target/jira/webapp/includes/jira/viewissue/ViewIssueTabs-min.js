define("jira/viewissue/tabs",["jira/util/logger","jira/util/formatter","jquery","jira/jquery/deferred","jira/util/data/meta","jira/dialog/form-dialog","jira/ajs/ajax/smart-ajax","jira/userhover/userhover","jira/viewissue/tabs/analytics"],function(t,e,a,i,n,r,s,o,u){function c(t){t=t||document,a.each(_,function(e,a){a(t)})}function l(t){var e=a(t).find(".issuePanelWrapper"),i=a(t).find("#issue_actions_container");k=i.length?i:k,C=e.length?e:C}function f(t,e){var a=new r({id:"issue-tab-error-dialog",widthClass:"small",content:s.buildDialogErrorContent(t,!1)});d(e),k.show(),a.show()}function d(t){a("#issue-tabs li").each(function(){var e=a(this),i=e.data("key"),n=e.data("label");if(i==t)e.addClass("active"),e.html(T.label({text:n}));else{e.removeClass("active");var r=e.data("id"),s=e.data("href");e.html(T.tab({id:r,href:s,linkClass:I,text:n}))}}),p(a("#issue-tabs"))}function h(t){d(t)}function v(t,e){var a=t.pageX,i=t.pageY,n=e.offset(),r=e.outerWidth(),s=e.outerHeight();return 0==a&&0==i||!(a>=n.left&&a<=n.left+r&&i>=n.top&&i<=n.top+s)}function p(t){var e=a(t).find("li.active").data("key");a(t).find(S).click(function(t){var i=a(this),n=v(t,i),r=i.parent().data("key"),s=t.metaKey;r?u.tabClicked(i,s,n):u.buttonClicked(i,s,n),s||(t.preventDefault(),r&&h(r),m(e,i.attr("href")).done(function(t){n&&(r?t.find("#"+i.attr("id")+" > :first-child").focus():t.find(".sortwrap  > :first-child").focus())}).done(c))})}function m(e,n){var r=i();q&&q.abort();var o=s.makeRequest({jqueryAjaxFn:R?a.pjax:a.ajax,headers:{"X-PJAX":!0},container:J,url:n,timeout:null,complete:function(i,n,s){if("abort"!=n){if(q=null,!s.successful)return void((s.status<300||s.status>=400)&&f(s,e));var o=a(this.container),u=document.createElement("div");u.innerHTML=s.data;var c=document.createDocumentFragment().appendChild(u);R||b(o,c),t.trace("jira.issue.tab.loaded"),r.resolve(o)}}});return a(o).throbber({target:C}),q=o,r}function b(t,e){var i=e.querySelectorAll(".tabwrap"),n=t.find(".tabwrap"),r=a(e.querySelectorAll("#issue_actions_container")).contents(),s=k.contents();if(i.length&&n.length&&r.length&&s.length){n.replaceWith(i),k.stop(!0,!0);var o=k.height();k.append(r);var u=k.height()-o,c=o-u;c>0?(k.css("height",u+c),s.remove(),g(u,c)):k.empty().append(r),a(e.querySelectorAll("script")).each(function(){a.globalEval(this.text||this.textContent||this.innerHTML||"")})}else t.empty().append(e)}function g(t,e){var a=Math.min(e/800*1e3,1e3);setTimeout(function(){k.animate({height:t+1},a,"easeOutQuart",function(){k.css("height","auto")})},150)}function j(t){a(t).find(S).each(function(){var t=a(this);t.attr("href",t.attr("href")+"#issue-tabs")})}function y(t){!R||a.support.pjax?p(t):j(t)}function w(t){a(t).bind("moveToFinished",function(t,e){a("a.twixi:visible",e).focus()})}function x(t){t.find("time.livestamp").livestamp()}function A(t){a.inArray(t,_)<0&&_.push(t)}var C,k,q,T=JIRA.Templates.Issue.Tabs,R=!1!==n.get("viewissue-use-history-api"),I="ajax-activity-content",J="#activitymodule div.mod-content",S=e.format("a.{0}",I),_=[];return A(l),A(y),A(w),A(o),A(x),{onTabReady:A,domReady:c}}),AJS.namespace("JIRA.ViewIssueTabs",null,require("jira/viewissue/tabs"));