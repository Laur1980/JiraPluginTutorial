define("jira/viewissue/watchers-voters/entities/user-collection",["require"],function(e){var r=e("jira/message"),s=e("backbone"),t=e("underscore"),o=e("jquery"),n=e("wrm/context-path"),i=e("jira/util/formatter"),a=JIRA.Templates.Issue,u=s.Model.extend({idAttribute:"key"});return s.Collection.extend({model:u,initialize:function(e){if(void 0===e)throw new Error("Must supply options");if(!e.issueKey)throw new Error("Must supply issue key");if(this.issueKey=e.issueKey,!e.endpoint)throw new Error("Must supply an endpoint");if(this.endpoint=e.endpoint,!e.modelKey)throw new Error("Must supply an model key");this.modelKey=e.modelKey},url:function(){return[n(),"rest/api/2/issue",this.issueKey,this.endpoint].join("/")},parse:function(e){return e&&e[this.modelKey]?e[this.modelKey]:[]},ajax:function(e){return e=t.extend({url:this.url(),headers:{"Content-Type":"application/json"},success:t.bind(function(){this.fetch()},this),error:t.bind(function(e){404!==e.status&&this.handleErrorResponse(e,i.I18n.getText("issue.operations.watching.add.error"))},this)},e),o.ajax(e)},getUser:function(e){return o.ajax({url:n()+"/rest/api/2/user?username="+encodeURIComponent(e),error:t.bind(function(e){404!==e.status&&this.handleErrorResponse(e,i.I18n.getText("issue.operations.watching.add.error"))},this)})},handleErrorResponse:function(e,s){var t=this._parseResponse(e.responseText);if(t.errorMessages){var o=a.error({msg:s,errors:t.errorMessages});r.showErrorMsg(o,{closeable:!0})}this.trigger("errorOccurred")},_parseResponse:function(e){try{return JSON.parse(e)}catch(e){return this._showFatalErrorMessage(),null}},_showFatalErrorMessage:function(){var e="<p>"+i.I18n.getText("common.forms.ajax.error.dialog.heading")+"</p><p>"+i.I18n.getText("common.forms.ajax.error.dialog")+"</p>";r.showErrorMsg(e,{closeable:!0})}})});