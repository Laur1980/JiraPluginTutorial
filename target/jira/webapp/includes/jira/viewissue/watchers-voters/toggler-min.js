define("jira/viewissue/watchers-voters/toggler",["require"],function(t){var e=t("jira/ajs/ajax/smart-ajax"),a=t("jira/flag"),o=t("jquery"),n=t("wrm/context-path"),s=t("jira/util/formatter"),i=function(t,a,s,i,l){var c,u=a+"-on",f=a+"-off",g="/voters",d=t.next(".icon"),x="POST";t.hasClass(u)&&(x="DELETE"),-1!==a.indexOf("watch")&&(g="/watchers"),t.removeClass(u).removeClass(f),"POST"===x&&(c={dummy:!0}),o(e.makeRequest({url:n()+"/rest/api/1.0/issues/"+t.attr("rel")+g,type:x,dataType:"json",data:c,contentType:"application/json",complete:function(e,a,o){var n="POST"===x;o.successful?(n?(t.addClass(u),t.text(l.titleOn),i.attr("title",l.titleOn).text(l.textOn)):(t.addClass(f),t.text(l.titleOff),i.attr("title",l.titleOff).text(l.textOff)),s.text(o.data.count),s[n?"addClass":"removeClass"](u),s[n?"removeClass":"addClass"](f)):(o.aborted||r(o),n?(t.addClass(f),t.text(l.titleOff),i.attr("title",l.titleOff).text(l.textOff)):(t.addClass(u),t.text(l.titleOn),i.attr("title",l.titleOn).text(l.textOn)))}})).throbber({target:d})},r=function(t){var o=e.buildSimpleErrorContent(t,{alert:!0});if(t.hasData){var n=JSON.parse(t.data);n.errorMessages&&(o=n.errorMessages[0])}a.showErrorMsg(o,{closeable:!0})};o(document).delegate("#toggle-vote-issue","click",function(t){t.preventDefault(),o("#vote-toggle").click()}),o(document).delegate("#toggle-watch-issue","click",function(t){t.preventDefault(),o("#watching-toggle").click()});var l=function(t){o("input[type=hidden][id|=error]").each(function(e,a){var o=a.id.replace("error-","");t[o]=a.value})};o(document).delegate("#vote-toggle","click",function(t){t.preventDefault();var e={titleOn:s.I18n.getText("issue.operations.simple.voting.alreadyvoted"),titleOff:s.I18n.getText("issue.operations.simple.voting.notvoted"),textOn:s.I18n.getText("issue.operations.simple.unvote"),textOff:s.I18n.getText("issue.operations.simple.vote"),actionTextOff:s.I18n.getText("common.concepts.vote"),actionTextOn:s.I18n.getText("common.concepts.voted")},a=o(this),n=o(document.querySelectorAll("#vote-data")),r=o(document.querySelectorAll("#toggle-vote-issue"));l(e),i(a,"vote-state",n,r,e)}),o(document).delegate("#watching-toggle","click",function(t){t.preventDefault();var e={titleOn:s.I18n.getText("issue.operations.simple.stopwatching"),titleOff:s.I18n.getText("issue.operations.simple.startwatching"),textOn:s.I18n.getText("issue.operations.unwatch"),textOff:s.I18n.getText("issue.operations.watch"),actionTextOff:s.I18n.getText("common.concepts.watch"),actionTextOn:s.I18n.getText("common.concepts.watching")},a=o(this),n=o(document.querySelectorAll("#watcher-data")),r=o(document.querySelectorAll("#toggle-watch-issue"));l(e),i(a,"watch-state",n,r,e)})});