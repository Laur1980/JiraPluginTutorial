define("jira/viewissue/watchers-voters/views/watchers-no-browse-view",["require"],function(e){var t=e("jira/viewissue/watchers-voters/views/abstract-watchers-view"),r=e("jira/util/data/meta"),a=e("underscore"),i=e("jquery"),s=e("jira/util/logger"),n=e("jira/util/formatter"),o=JIRA.Templates.Issue;return t.extend({events:{"click .remove-recipient":"removeWatcher",submit:"addWatcher"},addWatcher:function(e){e.preventDefault(),this.removeInlineError();var t=i("#watchers-nosearch"),s=i.trim(t.val());t.attr("disabled","disabled"),this.hasUsername(s)?(t.removeAttr("disabled"),this.showInlineError(n.I18n.getText("watching.manage.user.already.watching",s)),t.val("")):this.collection.getUser(s).done(a.bind(function(e){var a=JIRA.Templates.Fields.recipientUsername({icon:e.avatarUrls["16x16"],username:e.name,displayName:e.displayName});s===r.get("remote-user")&&this.watch(),t.val(""),this.$(".watchers").append(a),this.collection.addWatcher(e.name),this._incrementWatcherCount()},this)).fail(a.bind(function(e){404===e.status&&this.showInlineError(n.I18n.getText("admin.viewuser.user.does.not.exist.title"))},this)).always(function(){t.removeAttr("disabled").focus()})},hasUsername:function(e){var t=!1;return this.$(".watchers li").each(function(){if(i(this).attr("data-username")===e)return t=!0,!1}),t},removeInlineError:function(){this.$(".error").remove()},showInlineError:function(e){i("<div />").addClass("error").text(e).insertAfter(this.$(".description"))},focus:function(){i("#watchers-nosearch").focus()},removeWatcher:function(e){e.preventDefault();var t=i(e.target).closest("li"),a=t.attr("data-username");a&&(t.remove(),this.collection.removeWatcher(a),this._decrementWatcherCount(),a===r.get("remote-user")&&this.unwatch()),s.trace("jira.issue.watcher.deleted")},_render:function(){this.$el.html(o.watchersNoBrowse({watchers:this.collection.toJSON()}))}})});