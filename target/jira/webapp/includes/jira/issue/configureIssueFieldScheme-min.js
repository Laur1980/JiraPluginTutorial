define("jira/issue/configureissuefieldscheme",["underscore","jquery","marionette","jira/analytics"],function(t,e,i,s){"use strict";return i.View.extend({ui:{defaultOptionSelect:"#default-option-select",addAllButton:"#addAllAvailableOptions",removeAllButton:"#removeAllSelectedOptions",selectedOptions:"#selectedOptions",availableOptions:"#availableOptions",submitButton:"#submitSave"},events:function(){return this.options&&t.isObject(this.options.ui)&&t.extend(this.ui,this.options.ui),{"click @ui.addAllButton":"moveAll","click @ui.removeAllButton":"moveAll","click @ui.submitButton":"submitForm"}},initialize:function(){var t=this;this.bindUIElements(),this.ui.selectedOptions.sortable({opacity:.7,connectWith:this.ui.availableOptions,update:function(e,i){i.sender||i.item.parent().is(t.ui.availableOptions)||t.sendAnalyticsEvent("reordered")},receive:function(){t.sendAnalyticsEvent("added")},remove:function(){t.sendAnalyticsEvent("removed")}}),this.ui.availableOptions.sortable({update:this.restrictOptions.bind(this),opacity:.7,connectWith:this.ui.selectedOptions}),this.restrictOptions()},moveAll:function(t){t.preventDefault();var e=void 0,i=void 0;this.ui.addAllButton.is(t.target)?(e=this.ui.availableOptions,i=this.ui.selectedOptions):(e=this.ui.selectedOptions,i=this.ui.availableOptions),e.find("li").appendTo(i),this.restrictOptions()},sendAnalyticsEvent:function(t){s.send({name:"administration.issuetypeschemes.issuetype."+t+".global"})},getSelectedOptions:function(){return this.ui.selectedOptions.sortable("serialize",{key:"selectedOptions"})||"selectedOptions="},restrictOptions:function(){var i=this.getSelectedOptions().replace(/selectedOptions=/g,""),s=i.split("&"),n=this.ui.defaultOptionSelect.get(0),o=n.options[0];e(n.options).slice(1).each(function(i,n){var l=e(n);t.contains(s,n.value)?l.removeClass("hidden"):(n.selected&&(n.selected=!1,o.selected=!0),l.addClass("hidden"))})},submitForm:function(t){var e=t.target.form;return e.action=e.action+"?"+this.getSelectedOptions(),!0}})});