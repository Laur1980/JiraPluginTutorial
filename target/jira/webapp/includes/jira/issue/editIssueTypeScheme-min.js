require(["jira/analytics","jira/dialog/form-dialog","aui/params","underscore","jquery"],function(e,t,i,n,s){"use strict";function a(){s("#selectedOptionsRemoveAll").click(function(e){p("selectedOptions","availableOptions"),e.preventDefault()}),s("#selectedOptionsAddAll").click(function(e){p("availableOptions","selectedOptions"),e.preventDefault()}),s("#selectedOptions").sortable({opacity:.7,connectWith:[document.getElementById("availableOptions")],update:function(e,t){t.sender||"availableOptions"===t.item.parent()[0].id||m("reordered")},receive:function(){m("added")},remove:function(){m("removed")}}),i.allowEditOptions&&s("#availableOptions").sortable({update:u,opacity:.7,connectWith:[document.getElementById("selectedOptions")]}),s("#submitSave").click(function(){d(this)}),s("#submitReset").click(function(e){i.resetUrl&&(s(this).removeDirtyWarning(),window.location=i.resetUrl),e.preventDefault()}),s("#issue-type-scheme-name, #issue-type-scheme-description, #default-issue-type-select").change(r),new t({trigger:"#add-new-issue-type-to-scheme",id:"add-new-issue-type-to-scheme-dialog",ajaxOptions:{data:{decorator:"dialog",inline:"true"}},onSuccessfulSubmit:function(t){var i=s("<div>").html(t).find("#add-issue-type-template");i.find("li").appendTo("#selectedOptions");var n=i.find("select");n.length>0&&(s("#default-issue-type-select").unbind().replaceWith(n),n.attr("id","default-issue-type-select").change(r)),u(),e.send({name:"administration.issuetypeschemes.issuetype.created.global"})},onDialogFinished:function(){this.hide()}}),u()}var o=[{selector:"#issue-type-scheme-name",name:"schemeName"},{selector:"#issue-type-scheme-description",name:"schemeDescription"},{selector:"input[name='fieldId']",name:"fieldId"},{selector:"input[name='schemeId']",name:"schemeId"},{selector:"input[name='projectId']",name:"projectId"},{selector:"#default-issue-type-select",name:"defaultOption"}],c=void 0,l=function(){var e=s("#selectedOptions").sortable("serialize",{key:"selectedOptions"});return""===e?"selectedOptions=":e},d=function(e){return e.form.action="ConfigureOptionSchemes.jspa?"+l(),!0},r=function(){for(var e="AddNewIssueTypeToScheme!input.jspa?"+l(),t={},i=0;i<o.length;i++){var n=s(o[i].selector);t[o[i].name]=n.val()}e=e+"&"+s.param(t),s("#add-new-issue-type-to-scheme").attr("href",e)},u=function(){var e=l().replace(/selectedOptions=/g,""),t=e.split("&"),i=document.getElementById("default-issue-type-select");s.each(i.options,function(e,n){""===n.value||s.inArray(n.value,t)>-1?s(n).css({display:"",color:"#000",textDecoration:"none"}).removeAttr("disabled"):(n.selected&&(n.selected=!1,i.options[0].selected=!0),s(n).css({display:"none",color:"#ffcccc",textDecoration:"line-through"}).attr("disabled","disabled"))}),r()},p=function(e,t){s("#"+e).find("li").appendTo(document.getElementById(t)),u()},m=function(t){n.isUndefined(c)&&((c=s("input[name=schemeId]").val())||(c=!1)),c&&e.send({name:"administration.issuetypeschemes.issuetype."+t+".global"})};s(a)});