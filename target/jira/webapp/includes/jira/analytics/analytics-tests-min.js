AJS.test.require(["jira.webresources:jira-events","jira.webresources:ajs-underscorejs-amd-shim","jira.webresources:jira-analytics"],function(){var e=require("jquery"),s=require("underscore");require("jira/ajs/dark-features");module("analytics",{setup:function(){this.sendSpy=sinon.spy(),this.darkFeatures=sinon.stub(),this.context=AJS.test.mockableModuleContext(),this.context.mock("jira/analytics",{send:this.sendSpy}),this.context.mock("jira/ajs/dark-features",this.darkFeatures),this.context.require("jira/analytics/analytics").bindEvents()},assertAfterClick:function(i,r,a){var n=e(i);n.appendTo("#qunit-fixture"),n.click(),ok(this.sendSpy.calledOnce,"Event added only once");var t=this.sendSpy.args[0][0];equal(t.name,r,"Check event name"),a&&s.each(a,function(e,s){equal(t.properties[s],e,"Check property '"+s+"'")}),this.sendSpy.reset()}}),test("View workflow on view issue page",function(){var e=this.darkFeatures.isEnabled=sinon.stub();e.returns(!1),this.assertAfterClick("<a class='issueaction-viewworkflow' href='#'></a>","issue.viewworkflow",{version:"old",newEnabled:!1}),this.assertAfterClick("<a class='issueaction-viewworkflow new-workflow-designer' href='#'></a>","issue.viewworkflow",{version:"new",newEnabled:!1}),this.assertAfterClick("<a class='issueaction-viewworkflow jira-workflow-designer-link' href='#'></a>","issue.viewworkflow",{version:"new",newEnabled:!1}),e.returns(!0),this.assertAfterClick("<a class='issueaction-viewworkflow' href='#'></a>","issue.viewworkflow",{version:"old",newEnabled:!0}),this.assertAfterClick("<a class='issueaction-viewworkflow new-workflow-designer' href='#'></a>","issue.viewworkflow",{version:"new",newEnabled:!0}),this.assertAfterClick("<a class='issueaction-viewworkflow jira-workflow-designer-link' href='#'></a>","issue.viewworkflow",{version:"new",newEnabled:!0})})});