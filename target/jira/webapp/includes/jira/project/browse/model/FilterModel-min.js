define("jira/project/browse/filtermodel",["backbone","jquery","wrm/context-path","jira/util/navigation"],function(e,t,o,i){"use strict";var n=o();return e.Model.extend({defaults:{contains:""},initialize:function(e,t){this.pageableCollection=t.pageableCollection,this.on("change:category change:contains change:projectType",this.filterCollection),this.on("change:category change:contains change:projectType",this.triggerFilterEvent)},changeCategory:function(e){e&&(t.ajax({url:n+"/rest/api/1.0/browse-project/category/active",data:JSON.stringify({current:e.get("id")}),dataType:"json",contentType:"application/json",type:"POST"}),this.set("category",e.toJSON()))},changeProjectType:function(e){e&&(t.ajax({url:n+"/rest/api/1.0/browse-project/project-type/active",data:e.get("id"),dataType:"json",contentType:"application/json",type:"POST"}),this.set("projectType",e.toJSON()))},filterCollection:function(){var e=this.pageableCollection.originalCollection,t=this.get("category")?this.get("category").id:"",o=this.get("projectType")?this.get("projectType").key:null,i=(this.get("contains")||"").toLowerCase();null!==o&&"all"!==o&&(e=e.filter(function(e){return e.projectTypeKey==o||""===o&&null===e.projectTypeKey})),t&&"all"!==t&&(e=e.filter(function(e){return"none"==t&&!e.projectCategoryId||"recent"==t&&1==e.recent||e.projectCategoryId==t})),""!=i&&(e=e.filter(function(e){return e.name&&e.name.toLowerCase().indexOf(i)>-1||e.key&&e.key.toLowerCase().indexOf(i)>-1||e.lead&&e.lead.toLowerCase().indexOf(i)>-1})),this.pageableCollection.fullCollection.reset(e),this.pageableCollection.getPage(1)},triggerFilterEvent:function(){this.trigger("filter",this.getQueryParams(!1))},getQueryParams:function(e){e=void 0===e||e;var t={selectedCategory:this.get("category")?this.get("category").id:"",selectedProjectType:this.get("projectType")?this.get("projectType").id:"",contains:this.get("contains")||!1};return e?i.buildQuery(t):t}})});