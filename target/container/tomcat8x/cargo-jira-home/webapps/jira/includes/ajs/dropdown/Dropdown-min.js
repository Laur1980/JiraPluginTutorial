define("jira/ajs/dropdown/dropdown",["jira/ajs/control","jira/ajs/layer/inline-layer","jira/ajs/layer/layer-constants","jira/ajs/layer/layer-interactions","jira/ajs/layer/hide-reasons","jira/ajs/dropdown/dropdown-constants","jira/ajs/dropdown/dropdown-list-item","jira/ajs/dropdown/dropdown-options-descriptor","underscore","jquery"],function(t,r,e,i,o,n,s,l,a,h){var g=t.extend({CLASS_SIGNATURE:"AJS_DROPDOWN",init:function(t){var e,i,o,n=this;this.options=t instanceof l?t:new l(t),e=this.options.trigger(),i=this._ensureIdOf(e),o=this.options.allProperties(),o.offsetTarget||(o.offsetTarget=o.trigger),o.id||(o.id=i+"_drop"),this.layerController=new r(o),this.layerController._validateClickToClose=function(t){return t.target!==this.offsetTarget()[0]&&(t.target!==this.layer()[0]&&!(this.offsetTarget().has(t.target).length>0))},this.listController=this.options.listController(),this.listController.bind("change:activeItem",function(t,r){r.$element.find("a").focus()}),this.layerController.onhide(function(){n.hide()}),this.layerController.onerror(function(){h.isFunction(n.options.properties.onerror)&&n.options.properties.onerror(n)}),this.layerController.contentChange(function(){n.listController.removeAllItems(),n.layerController.layer().find("div > ul > li:visible:has(a)").each(function(){n.listController.addItem(new s({element:this,autoScroll:n.options.autoScroll()}))}),n.options.focusFirstItem()?n.listController.shiftFocus(0):n.listController.prepareForInput()}),this.trigger(e),this._applyIdToLayer()},show:function(){this.trigger().addClass(e.ACTIVE_CLASS),h(this).trigger("showLayer"),this.layerController.show(),this.options.focusFirstItem()?this.listController.shiftFocus(0):this.listController.prepareForInput()},hide:function(){h(this).trigger("hideLayer"),this.trigger().removeClass(e.ACTIVE_CLASS),this.layerController.hide(),this.listController.trigger("blur")},toggle:function(){this._toggling||(this._toggling=!0,this.layerController.isVisible()?this.hide():this.show(),setTimeout(function(){this._toggling=!1}.bind(this),0))},content:function(t){if(!t)return this.layerController.content();this.layerController.content(t)},trigger:function(t){if(!t)return this.options.trigger();this.options.trigger()&&this._unassignEvents("trigger",this.options.trigger()),this.options.trigger(h(t)),this.layerController.offsetTarget()||this.layerController.offsetTarget(this.options.trigger()),this._assignEvents("trigger",this.options.trigger())},_ensureIdOf:function(t){var r=t.attr("id");return a.isEmpty(r)&&(r=t.attr("id",a.uniqueId(this.CLASS_SIGNATURE+"__"))),r},_applyIdToLayer:function(){var t=this._ensureIdOf(this.trigger()),e=this.layerController.layer().attr("id")||t+"_drop";this.layerController.layer().attr({id:e,role:"menu","aria-hidden":!0}),this.trigger().attr({"aria-controls":e,"aria-haspopup":!0,"aria-expanded":!1}),this.layerController.bind(r.EVENTS.show,function(){this.trigger().attr("aria-expanded",!0)}.bind(this)),this.layerController.bind(r.EVENTS.hide,function(t,r,e){this.trigger().attr("aria-expanded",!1),this.trigger().one("beforeBlurInput",function(t){t.preventDefault()}),e===o.escPressed&&this.trigger().focus()}.bind(this))},_events:{trigger:{"aui:keydown":function(t){"Return"!==t.key&&"Spacebar"!==t.key||(t.preventDefault(),this.toggle())},click:function(t){t.preventDefault(),this.toggle()}}}});return h.extend(g,n),i.preventDialogHide(g),i.hideBeforeDialogShown(g),g}),AJS.namespace("AJS.DropDown",null,require("jira/ajs/dropdown/dropdown")),AJS.namespace("AJS.Dropdown",null,require("jira/ajs/dropdown/dropdown"));