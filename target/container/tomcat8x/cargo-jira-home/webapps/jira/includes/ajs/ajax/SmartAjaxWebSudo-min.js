define("jira/ajs/ajax/smart-ajax/web-sudo",["jira/jquery/deferred","jira/ajs/ajax/smart-ajax","jira/ajs/ajax/ajax-util","jira/dialog/dialog","jira/dialog/form-dialog","jira/util/browser","wrm/context-path","jquery"],function(e,a,t,o,s,i,n,c){"use strict";var u=n();return{showWebSudoDialog:function(e){var t=e.context||this,n=new s({id:"smart-websudo",type:"ajax",ajaxOptions:{url:u+"/secure/admin/WebSudoAuthenticate!default.jspa?close=true"},submitHandler:function(o,s){o.preventDefault();var i=c(o.target);a.makeRequest({url:i.attr("action"),data:i.serialize(),type:"POST",complete:function(a){"Has-Authentication"===a.getResponseHeader("X-Atlassian-WebSudo")?c.isFunction(e.success)?e.success.call(t,function(){s(),n.hide()}):(s(),n.hide()):n._setContent(a.responseText,!0)}})}});c.isFunction(e.cancel)&&c(n).one("Dialog.hide",function(a,s,n){n!==o.HIDE_REASON.cancel&&n!==o.HIDE_REASON.escape||(a=c.Event(),(!1===e.cancel.call(t,a)||!a.isDefaultPrevented())&&i.reloadViaWindowLocation(s.find(".cancel").attr("href")))}),c.isFunction(e.beforeShow)&&e.beforeShow.call(t),n.show(),c.isFunction(e.show)&&e.show.call(t)},handleWebSudoError:function(e,t,o,s,i){var n={success:function(o){t&&c.isFunction(t.success)?t.success.apply(this,arguments):o(),a.makeRequest(e)},cancel:function(){c.isFunction(e.complete)&&e.complete.call(this,o,s,i),t&&c.isFunction(t.cancel)&&t.cancel.apply(this,arguments)},beforeShow:function(){t&&c.isFunction(t.beforeShow)&&t.beforeShow.apply(this,arguments)},show:function(){t&&c.isFunction(t.show)&&t.show.apply(this,arguments)},context:this};this.showWebSudoDialog(n)},makeWebSudoRequest:function(o,s){var i=c.extend({},o),n=!1,u=e(),r=this,l=function(e,a,l,d){t.isWebSudoFailure(e)?(n=!0,r.handleWebSudoError(i,s,e,a,d)):(u.rejectWith(this,arguments),c.isFunction(o.error)&&o.error.apply(this,arguments))},d=function(){!n&&c.isFunction(o.complete)&&o.complete.apply(this,arguments),n=!1},h=function(){c.isFunction(o.success)&&o.success.apply(this,arguments),u.resolveWith(this,arguments)};return i.error=l,i.complete=d,i.success=h,a.makeRequest(i),u.promise()}}}),function(e){"use strict";AJS.namespace("JIRA.SmartAjax.showWebSudoDialog",null,e.showWebSudoDialog),AJS.namespace("JIRA.SmartAjax.handleWebSudoError",null,e.handleWebSudoError),AJS.namespace("JIRA.SmartAjax.makeWebSudoRequest",null,e.makeWebSudoRequest)}(require("jira/ajs/ajax/smart-ajax/web-sudo"));