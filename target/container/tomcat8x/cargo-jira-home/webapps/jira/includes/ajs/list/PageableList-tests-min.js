AJS.test.require(["jira.webresources:select-pickers"],function(){require(["jira/ajs/list/pageable-list","jira/ajs/list/item-descriptor","jira/ajs/list/group-descriptor","jquery","underscore"],function(e,t,s,r,i){module("PageableList",{setup:function(){this.descriptorsBuilder=function(e,r,i){i=i||!1;for(var n,o,a=[],l=1;l<=e;l++){n=new s({label:""+l,styleClass:"groupDescriptor"}),i&&n.footerText(l+1),o="[object Array]"===Object.prototype.toString.call(r)?r[l-1]:r;for(var g=1;g<=o;g++)n.addItem(new t({label:100*l+g+"",styleClass:"suggestion"}));a.push(n)}return a},this.selectionCallback=sinon.spy(),this.$container=r("<div></div>").appendTo(r("#qunit-fixture")),this.list=new e({containerSelector:this.$container,pageSize:5,pagingThreshold:5,selectionHandler:this.selectionCallback})}}),test("adding next page renders proper number of groups and suggestions",function(){var e=this.descriptorsBuilder(2,[6,5]);this.list.generateListFromJSON(e,""),equal(this.list.suggestions,5,"properly rendered first page of results"),equal(this.list.pageNumber,1,"proper page number"),equal(this.$container.find(".suggestion").length,5,"rendered proper number of suggestions"),equal(this.$container.find("ul.groupDescriptor").length,1,"rendered proper number of groups"),this.list.addNextPage(),equal(this.list.pageNumber,2,"proper page number"),equal(this.$container.find(".suggestion").length,10,"rendered proper number of suggestions"),equal(this.$container.find("ul.groupDescriptor").length,2,"rendered proper number of groups")}),test("does not render group twice",function(){var e=this.descriptorsBuilder(3,[12,4,4]);this.list.generateListFromJSON(e,""),this.list.addNextPage(),equal(this.$container.find("ul.groupDescriptor").length,1,"renders proper number of groups"),this.list.addNextPage(),equal(this.$container.find("ul.groupDescriptor").length,2,"renders proper number of groups")}),test("suggestions are placed before group footer",function(){var e=this.descriptorsBuilder(2,[12,5],!0);this.list.generateListFromJSON(e,""),this.list.addNextPage(),this.list.addNextPage(),ok(this.$container.find(".aui-list-section-footer").is(":last-child"),"every group footer is last element in group container")}),test("querying works as expected",function(){var e=this.descriptorsBuilder(3,[2,7,16]);this.list.generateListFromJSON(e,"10"),equal(this.list.suggestions,2,"properly filtered"),equal(this.$container.find(".suggestion").length,2,"properly filtered"),this.list.generateListFromJSON(e,"20"),this.list.addNextPage(),equal(this.list.suggestions,7,"properly paged filtered suggestions"),equal(this.$container.find(".suggestion").length,7,"properly paged filtered suggestions")}),test("changing query resets paging",function(){var e=this.descriptorsBuilder(2,11);this.list.generateListFromJSON(e,""),this.list.addNextPage(),this.list.generateListFromJSON(e,""),equal(this.list.pageNumber,2,"keeps pageNumber if query does not change"),this.list.generateListFromJSON(e,"10"),equal(this.list.pageNumber,1,"changes page number when query change")}),test("forcing all results works as expected",function(){var e=this.descriptorsBuilder(3,16);this.list.generateListFromJSON(e,"",!0),equal(this.list.suggestions,48,"rendered all results"),equal(this.$container.find(".suggestion").length,48,"rendered all results")}),test("paginating only if pagination threshold is met",function(){var t=new e({pageSize:5,pagingThreshold:10,containerSelector:this.$container}),s=this.descriptorsBuilder(2,[5,4]),r=this.descriptorsBuilder(3,5);t.generateListFromJSON(s,""),equal(t.suggestions,9,"rendered all results"),equal(this.$container.find(".suggestion").length,9,"rendered all results"),t.generateListFromJSON(r,""),equal(t.suggestions,5,"pages results properly"),equal(this.$container.find(".suggestion").length,5,"pages results properly")}),test("closing a dropdown should reset pageNumber property",function(){var t=new e({pageSize:5,pagingThreshold:10,containerSelector:this.$container}),s=this.descriptorsBuilder(3,5);t.generateListFromJSON(s,""),equal(t.pageNumber,1,"initial state, first page"),t.addNextPage(),equal(t.pageNumber,2,"requested next page, pageNumber should have increased"),t.disable(),equal(t.pageNumber,1,"dropdown closed, reset to first page")})})});