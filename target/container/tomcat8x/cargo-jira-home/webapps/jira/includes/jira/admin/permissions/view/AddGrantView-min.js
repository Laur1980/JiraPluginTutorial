define("jira/project/permissions/addgrantview",["jira/util/formatter","jira/field/user-picker-util","jira/field/group-picker-util","jira/ajs/list/item-descriptor","backbone","underscore","jquery","jira/ajs/select/single-select","jira/project/permissions/securitytypes","jira/field/role-picker-util","wrm/context-path"],function(e,t,i,n,s,r,a,l,d,o,c){"use strict";return require("aui/inline-dialog2"),s.View.extend({tagName:"div",className:"radio",template:JIRA.Templates.AddProjectPermission.renderSecurityTypeItem,events:{"click .security-type-item-radio-btn":"handleSelect"},initialize:function(){this.listenTo(this.model,"change:selected",this.toggleSecurityType)},render:function(){if(d.isCustomFieldType(this.model.get("securityType"))&&0===this.model.get("values").length)return this.$el.hide(),this;this.$el.append(this.template(this.model.toJSON())),this.model.get("primary")||this.$el.addClass("secondary");var e=this.renderInput();return void 0!==e&&(void 0!==e.$container?this.inputView=e.$container:this.inputView=e,this.$el.find(".single-select-parent").append(this.inputView)),this},handleParamSelect:function(e){var t=a(e.target).val();this.model.set("securityTypeParamVal",t)},renderInput:function(){var s;switch(this.model.get("securityType")){case d.USER_CF:case d.GROUP_CF:case d.PROJECT_ROLE:var m=JIRA.Templates.AddProjectPermission.renderSelect({id:this.model.get("securityType"),data:this.model.get("values")}),h=new l({element:a(m),revertOnInvalid:!0,itemAttrDisplayed:"label"});h.model.$element.bind("selected",r.bind(this.handleParamSelect,this)),this.model.set("securityTypeParamVal",h.model.$element.val()),h.$container.hide(),s=h;break;case d.APPLICATION_ROLE:var p=JIRA.Templates.AddProjectPermission.renderSelect({id:this.model.get("securityType"),data:this.model.get("values"),emptyValue:e.I18n.getText("admin.permission.types.application.role.any")}),u=new l({element:a(p),itemAttrDisplayed:"label",showDropdownButton:!0,revertOnInvalid:!0,ajaxOptions:{data:function(e){return{query:e}},query:!0,formatResponse:function(t){var i=o.formatResponse(t);return i.unshift(new n({value:"",label:e.I18n.getText("admin.permission.types.application.role.any"),highlighted:!0})),i}}});u.model.$element.bind("selected",r.bind(this.handleParamSelect,this)),this.model.set("securityTypeParamVal",u.model.$element.val()),u.$container.hide(),s=u;break;case d.GROUP:var m=JIRA.Templates.AddProjectPermission.renderSelect({id:this.model.get("securityType"),emptyValue:e.I18n.getText("admin.common.words.anyone")}),y=new l({element:a(m),itemAttrDisplayed:"label",showDropdownButton:!0,revertOnInvalid:!0,ajaxOptions:{data:function(e){return{query:e}},url:c()+"/rest/api/2/groups/picker",query:!0,formatResponse:function(t){var s=i.formatResponse(t);return s.unshift(new n({value:"",label:e.I18n.getText("admin.common.words.anyone"),highlighted:!0})),s}}});y.model.$element.bind("selected",r.bind(this.handleParamSelect,this)),this.model.set("securityTypeParamVal",y.model.$element.val()),y.$container.hide(),s=y;break;case d.SINGLE_USER:var g,f,v=this.model.get("help");v?(g=a(JIRA.Templates.AddProjectPermission.renderSelectWithInfo({id:this.model.get("securityType"),infoText:v.infoText,helpText:v.helpText,helpUrl:v.helpUrl})),f=g.find("select")):(g=a(JIRA.Templates.AddProjectPermission.renderSelect({id:this.model.get("securityType")})),f=g);var T=new l({element:f,submitInputVal:!0,errorMessage:e.I18n.getText("user.picker.invalid.user","'{0}'"),revertOnInvalid:!0,ajaxOptions:{url:c()+"/rest/api/latest/user/picker",query:!0,data:{showAvatar:!0},formatResponse:t.formatResponse}});T.model.$element.bind("selected",r.bind(this.handleParamSelect,this)),this.model.set("securityTypeParamVal",T.model.$element.val()),v?(s=g,s.hide()):(s=T,s.$container.hide())}return s},handleSelect:function(e){this.model.set("selected",!0)},toggleSecurityType:function(){this.inputView&&(this.model.get("selected")?this.inputView.show():this.inputView.hide())}})}),define("jira/project/permissions/addgrantcollectionview",["backbone","underscore","jira/project/permissions/addgrantview"],function(e,t,i){"use strict";return e.View.extend({tagName:"fieldset",className:"group security-type-list-content",initialize:function(){var e=this;this._addGrantViews=[],this.collection.each(function(t){e._addGrantViews.push(new i({model:t}))}),this.listenTo(this.collection,"change:selected",this.handleSelect)},render:function(){var e=this;return this.$el.append(JIRA.Templates.AddProjectPermission.grantLegend()),t.each(this._addGrantViews,function(t){e.$el.append(t.render().$el)}),this},isSelectedVisible:function(){return this.$el.find(".radio > input[type=radio]:checked").is(":visible")},handleSelect:function(e,t){t&&this.collection.each(function(t){e!==t&&t.set("selected",!1)})}})});