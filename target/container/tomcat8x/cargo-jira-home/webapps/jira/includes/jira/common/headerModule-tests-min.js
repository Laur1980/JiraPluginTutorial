AJS.test.require(["jira.webresources:jira-global"],function(){var e,s=require("backbone"),t=require("underscore"),r=require("jquery");module("Header Message Tests",{setup:function(){e=JIRA.Issues,JIRA.Issues={},JIRA.Issues.Application={},JIRA.Issues.Application=t.extend({},s.Events),this.header=require("jira/common/header"),this.header.unbind(),this.header.initialize(),this.removeFlags(),this.assertNoFlags()},teardown:function(){this.removeFlags(),this.header.unbind(),JIRA.Issues=e},removeFlags:function(){r(".aui-flag").remove()},assertNoFlags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No message shown initially";equal(r(".aui-flag").length,0,e)}});var i=function(e,s){var t=r(".aui-flag");equal(t.length,1,"Global message should be shown");for(var i=t.text(),n=0;n<e.length;n++)ok(i.indexOf(e[n])>=0,"Global message contains text '"+e[n]+"'.");for(var a=0;a<s.length;a++)ok(i.indexOf(s[a])<0,"Global message does not contain text '"+s[a]+"'.")};test("Correct message shows up on component created via quickcreate",function(){JIRA.trigger("Issue.Component.new.selected"),JIRA.trigger("QuickCreateIssue.sessionComplete",[{issueKey:"HSP-1",summary:"A sample issue"}]),i(["createissue.issuecreated","jira.component.created.quick.create"],["jira.version.created.quick.create"])}),test("Correct message shows up on version created via quickcreate",function(){JIRA.trigger("Issue.Version.new.selected"),JIRA.trigger("QuickCreateIssue.sessionComplete",[{issueKey:"HSP-1",summary:"A sample issue"}]),i(["createissue.issuecreated","jira.version.created.quick.create"],["jira.component.created.quick.create"])}),test("Correct message shows up on version created with multiple issues created via quickcreate",function(){JIRA.trigger("Issue.Version.new.selected"),JIRA.trigger("QuickCreateIssue.sessionComplete",[{issueKey:"HSP-1",summary:"A sample issue"},{issueKey:"HSP-2",summary:"A second sample issue"}]),i(["createissue.issuecreated","jira.version.created.quick.create"],["jira.component.created.quick.create"])}),test("Correct message shows up on version and component created via quickcreate",function(){JIRA.trigger("Issue.Version.new.selected"),JIRA.trigger("Issue.Component.new.selected"),JIRA.trigger("QuickCreateIssue.sessionComplete",[{issueKey:"HSP-1",summary:"A sample issue"}]),i(["createissue.issuecreated","jira.version.created.quick.create","jira.component.created.quick.create"],[])}),test("Correct message shows up on version created via inline-edit",function(){JIRA.Issue.getIssueKey=sinon.stub().returns("HSP-1"),JIRA.trigger("Issue.Version.new.selected"),JIRA.Issues.Application.trigger("issueEditor:saveSuccess"),i(["jira.version.created"],["createissue.issuecreated","jira.component.created"])}),test("Correct message shows up on component created via inline-edit",function(){JIRA.Issue.getIssueKey=sinon.stub().returns("HSP-1"),JIRA.trigger("Issue.Component.new.selected"),JIRA.Issues.Application.trigger("issueEditor:saveSuccess"),i(["jira.component.created"],["createissue.issuecreated","jira.version.created"])}),test("Correct message shows up on version and component created via inline-edit",function(){JIRA.Issue.getIssueKey=sinon.stub().returns("HSP-1"),JIRA.trigger("Issue.Component.new.selected"),JIRA.trigger("Issue.Version.new.selected"),JIRA.Issues.Application.trigger("issueEditor:saveSuccess"),i(["jira.component.created","jira.version.created"],["createissue.issuecreated"])}),test("unbind should only remove header's handlers for QuickEdit",function(){var e=sinon.spy(),s=sinon.spy(),t=sinon.spy();JIRA.bind("QuickEdit.sessionComplete",e),JIRA.bind("Issue.Version.new.selected",s),JIRA.bind("Issue.Component.new.selected",t),this.header.unbind(),JIRA.trigger("Issue.Component.new.selected"),JIRA.trigger("Issue.Version.new.selected"),JIRA.trigger("QuickEdit.sessionComplete"),this.assertNoFlags("Global message should NOT be shown"),equal(e.callCount,1,"should be called even though header's handlers were not"),equal(s.callCount,1,"should be called even though header's handlers were not"),equal(t.callCount,1,"should be called even though header's handlers were not")})});