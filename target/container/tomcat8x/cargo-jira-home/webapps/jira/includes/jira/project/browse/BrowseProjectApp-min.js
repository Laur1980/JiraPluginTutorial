define("jira/project/browse/app",["require"],function(e){"use strict";var t=e("underscore"),i=e("backbone"),o=e("marionette"),r=e("jira/project/browse/layout"),s=e("jira/project/browse/tabsview"),c=e("jira/project/browse/projecttypestabsview"),a=e("jira/project/browse/projectcollection"),n=e("jira/project/browse/projectcollectionview"),l=e("jira/project/browse/paginationview"),p=e("jira/project/browse/filtermodel"),g=e("jira/project/browse/filterview"),h=e("jira/util/navigation"),j=e("jira/project/browse/categorycollection"),w=e("jira/project/browse/projecttypecollection"),y=e("jira/util/users/logged-in-user"),u=new o.Application;return u.on("start",function(e){var o=e.container;this.categories=new j(e.categories),this.availableProjectTypes=new w(e.availableProjectTypes),this.projects=new a(e.projects,{mode:"client",state:{pageSize:25,currentPage:1},categories:this.categories}),this.categories.selectCategory(e.selectedCategory),e.availableProjectTypes?(this.availableProjectTypes.selectProjectType(e.selectedProjectType)||this.availableProjectTypes.selectProjectType("all"),this.filter=new p({category:this.categories.getSelected().toJSON(),projectType:this.availableProjectTypes.getSelected().toJSON()},{pageableCollection:this.projects})):this.filter=new p({category:this.categories.getSelected().toJSON()},{pageableCollection:this.projects}),this.layout=new r({el:o}),this.projectCollectionView=new n({model:this.filter,collection:this.projects});var v=function(e){var t=u.categories.selectCategory(e);t&&u.filter.changeCategory(t)};""!==y.username()||this.categories.length>1?(this.tabsView=new s({collection:this.categories}),this.tabsView.on("category-change",v),this.layout.categoryNav.show(this.tabsView)):this.layout.$el.find(this.layout.categoryNav.el).addClass("hidden");var b=function(e){var t=u.availableProjectTypes.selectProjectType(e);t&&u.filter.changeProjectType(t)};if(this.availableProjectTypes.length>0?(this.projectTypesTabsView=new c({collection:this.availableProjectTypes}),this.projectTypesTabsView.on("project-type-change",b),this.layout.projectTypeNav.show(this.projectTypesTabsView)):this.layout.$el.find(".project-type-nav").addClass("hidden"),this.projectCollectionView.on("project-view.click-category",function(e){v(e.attributes.projectCategoryId)}),this.layout.content.show(this.projectCollectionView),this.layout.pagination.show(new l({collection:this.projects,model:this.filter})),this.layout.filter.show(new g({model:this.filter})),this.layout.pagination.currentView.on("navigate",function(e){var i=t.extend(u.filter.getQueryParams(!1),{page:e});h.navigate(i)}),this.filter.on("filter",function(e){h.navigate(e)}),(new(i.Router.extend({initialize:function(){this.route(/(.*)/,"every")}}))).on("route:every",function(){var e=+h.getParam("page",!0)||1,t=h.getParam("contains",!0)||"",i=h.getParam("selectedCategory")||"",o=u.categories.selectCategory(i),r=h.getParam("selectedProjectType")||"",s=u.availableProjectTypes.selectProjectType(r);u.filter.set("contains",t,{silent:!0}),!1!==o&&u.filter.set("category",o.toJSON(),{silent:!0}),!1!==s&&u.filter.set("projectType",s.toJSON(),{silent:!0}),u.filter.filterCollection(),u.projects.getPage(e),u.layout.filter.currentView.render()}),i.History.started||i.history.start({pushState:h.pushStateSupported,root:h.getBackboneHistoryRoot()}),window.location.hash){var f=window.location.hash.substring(1);this.categories.get(f)&&v(f)}this.listenTo(this.projectCollectionView,{"project-view.click-project-name":function(e,t){this.trigger("browse-projects.project-view.click-project-name",e,t)},"project-view.click-lead-user":function(e,t){this.trigger("browse-projects.project-view.click-lead-user",e,t)},"project-view.click-category":function(e,t){this.trigger("browse-projects.project-view.click-category",e,t)},"project-view.click-url":function(e,t){this.trigger("browse-projects.project-view.click-url",e,t)}}),void 0!==this.projectTypesTabsView&&this.listenTo(this.projectTypesTabsView,{"project-type-change":function(e){this.trigger("browse-projects.project-type-change",e)}}),void 0!==this.tabsView&&this.listenTo(this.tabsView,{"category-change":function(e){this.trigger("browse-projects.category-change",e)}}),this.listenTo(this.filter,{filter:function(){var e=u.projects.length;this.trigger("browse-projects.projects-render",e)}}),this.listenTo(this.layout.pagination.currentView,{navigate:function(e){this.trigger("browse-projects.navigate-to-page",e)},"navigate-previous":function(){this.trigger("browse-projects.navigate-to-previous")},"navigate-next":function(){this.trigger("browse-projects.navigate-to-next")}})}),u});