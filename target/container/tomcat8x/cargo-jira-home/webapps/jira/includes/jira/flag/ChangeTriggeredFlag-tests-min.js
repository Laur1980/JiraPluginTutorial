AJS.test.require(["jira.webresources:edit-project-details"],function(){function e(){var e=i("#aui-flag-container").find(".aui-flag");return e&&"false"===e.attr("aria-hidden")}function a(){i("#aui-flag-container").find(".aui-flag a.cancel").click()}function n(){i("#aui-flag-container").find(".aui-icon.icon-close").click()}function c(e){this.value=0;var a=this;return a.cancelCallback=sinon.spy(),e=l.defaults(e||{},{getValue:function(){return a.value},revert:function(){a.value=0},warningDescription:function(){return"warning"},cancelMessage:function(){return"cancel"},onCancelCallback:a.cancelCallback}),new h(e)}var i=require("jquery"),l=require("underscore"),h=require("jira/project/edit/change-triggered-flag");module("JIRA.Project.Flag.ChangeTriggeredFlag",{setup:function(){this.changeTriggeredFlag=c.call(this)},teardown:function(){i("#aui-flag-container").remove()}}),test("On a value change the flag is shown",function(){this.value=1,this.changeTriggeredFlag.changeOccurred(),ok(e(),"Should have shown the flag on a change")}),test("On changing the value back the flag should go away",function(){this.value=1,this.changeTriggeredFlag.changeOccurred(),ok(e(),"Should have shown the flag on a change"),this.value=0,this.changeTriggeredFlag.changeOccurred(),ok(!e(),"Should have hidden the flag"),ok(this.cancelCallback.calledOnce)}),test("Clicking cancel on the flag reverts to the original value",function(){this.value=1,this.changeTriggeredFlag.changeOccurred(),a(),this.changeTriggeredFlag.changeOccurred(),equal(this.value,0,"Should have reverted back to the original value"),ok(this.cancelCallback.calledOnce)}),test("Clicking dismiss on flag will never show it again even when changing",function(){this.value=1,this.changeTriggeredFlag.changeOccurred(),n(),ok(!e(),"Should have hidden the flag when cancelled"),this.value=2,this.changeTriggeredFlag.changeOccurred(),ok(!e(),"Should have hidden the flag when cancelled"),this.value=0,this.changeTriggeredFlag.changeOccurred(),ok(!e(),"Should have hidden the flag when cancelled"),this.value=2,this.changeTriggeredFlag.changeOccurred(),ok(!e(),"Should have hidden the flag when cancelled")})});