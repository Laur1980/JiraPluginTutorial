define("jira/field/favourite-picker",["jira/util/formatter","wrm/context-path","jquery"],function(e,t,a){"use strict";var i=function(i){var r,n=i.entityId,o=i.entityType,d=i.tableId+"_"+o+"_"+n,l=a("#fav_a_"+d),u=i.enabled,s=a("#undo_div"),f=a("#fav_count_enabled_"+d),c=a("#fav_count_disabled_"+d),v=i.relatedDropdown;"PortalPage"===o?r="dashboards":"SearchRequest"===o&&(r="filters");var p=t()+"/rest/api/1.0/"+r+"/"+n+"/favourite",m=[],b=function(){if(void 0!==i.undoText){var t=i.undoEntityName,r=a("<p/>").html(e.format(i.undoText,t)),n=a("#"+i.removeId);r.find("a").attr("id","fav_undo_a_"+i.removeId).click(function(e){e.preventDefault();var t=void 0;m.length>0&&(t={entries:m}),a.ajax({url:p,contentType:"application/json",data:JSON.stringify(t),type:"POST",success:function(){r.remove(),u="true",w(),n.show(),0===s.find("p").length&&s.addClass("hidden"),recolourSimpleTableRows(i.tableId)},error:function(){alert(a(".favourite-params").find("#errorMsg").val())}})}),n.hide(),recolourSimpleTableRows(i.tableId),s.append(r),s.removeClass("hidden")}},h=function(){"true"===u?a(a.ajax({url:p,type:"DELETE",success:function(){u="false",w(),b()},error:function(){alert(a(".favourite-params").find("#errorMsg").val())}})).throbber({target:l}):a(a.ajax({url:p,type:"PUT",success:function(){u="true",w()},error:function(){alert(a(".favourite-params").find("#errorMsg").val())}})).throbber({target:l})},_=function(){v&&JIRA.Dropdown[v]&&JIRA.Dropdown[v].resetCache()},w=function(){"true"===u?(l.addClass("enabled aui-iconfont-star").removeClass("disabled aui-iconfont-unstar").attr("title",i.titleAdd).text(i.titleAdd),f.show(),c.hide()):(l.addClass("disabled aui-iconfont-unstar").removeClass("enabled aui-iconfont-star").attr("title",i.titleRemove).text(i.titleRemove),f.hide(),c.show()),_()};w(),l.click(function(e){e.preventDefault(),h()}),function(){a("#"+i.tableId).find("[id^=fav_div_]").each(function(e,t){m[m.length]=a(t).attr("rel")})}()};return i.NewPicker=function(e){var t=e.fieldId,i=a("#fav_a_"+t),r=a("#fav_new_"+t),n=e.enabled,o=function(){"true"===n?(i.addClass("enabled aui-iconfont-star").removeClass("disabled aui-iconfont-unstar").attr("title",e.titleAdd).find("span").text(e.titleAdd),r.val("true")):(i.addClass("disabled aui-iconfont-unstar").removeClass("enabled aui-iconfont-star").attr("title",e.titleRemove).find("span").text(e.titleRemove),r.val("false"))};o(),i.click(function(e){e.preventDefault(),n="true"===n?"false":"true",o()})},i.init=function(e){a(".favourite-params",e).each(function(){var e={};a(this).find("input").each(function(){var t=a(this);e[t.attr("id")]=t.val()}),"false"===e.remote?i.NewPicker(e):i(e)})},i}),AJS.namespace("JIRA.FavouritePicker",null,require("jira/field/favourite-picker")),AJS.namespace("jira.widget.favourite",null,{Picker:JIRA.FavouritePicker,NewPicker:JIRA.FavouritePicker.NewPicker});