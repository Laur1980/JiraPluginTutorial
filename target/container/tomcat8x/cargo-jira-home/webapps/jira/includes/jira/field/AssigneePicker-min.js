define("jira/field/assignee-picker",["jira/util/formatter","jira/ajs/select/scrollable-single-select","jira/ajs/select/suggestions/assignee-suggest-handler","jira/ajs/list/group-descriptor","jira/ajs/list/item-descriptor","wrm/context-path","aui/params","jquery","underscore"],function(e,t,i,s,n,a,r,o,l){"use strict";function u(e){return l.find(e,function(e){return"assignee-group-search"===e.id()})}var g=a();return t.extend({init:function(t){function a(e){return r.actionDescriptorId=void 0,AJS.populateParameters(),{username:e,projectKeys:r.projectKeys,issueKey:r.assigneeEditIssueKey,actionDescriptorId:r.actionDescriptorId,maxResults:50,startAt:0===u._pagination.numberOfShowingItems?0:u._pagination.numberOfShowingItems+1}}function l(t){var i=[];if(t.length){for(var a=new s({weight:1,id:"assignee-group-search",uniqueItemScope:"container",replace:!0,label:e.I18n.getText("assignee.picker.group.search")}),r=0,o=t.length;r<o;r++){var l=t[r],u=l.name,g=l.displayName,p=l.emailAddress,h=g;p&&(h+=" - "+p),h+=" ("+u+")",a.addItem(new n({value:u,fieldText:g,label:h,allowDuplicate:!1,icon:l.avatarUrls["16x16"]}))}i.push(a)}return i}var u=this,p=t.element instanceof o?t.element:o(t.element);u._pagination={lastQuery:null,numberOfShowingItems:0,allResultsDisplayed:!1,requestNextPagePromise:null},t=o.extend(!0,{},{submitInputVal:!0,showDropdownButton:!!p.data("show-dropdown-button"),errorMessage:e.I18n.getText("assignee.picker.invalid.user"),localDataGroupId:"assignee-group-suggested",content:"mixed",suggestionAtTop:!0,removeDuplicates:!0,ajaxOptions:{url:function(){r.assigneeEditIssueKey=void 0,AJS.populateParameters();var e=r.assigneeEditIssueKey?"search":"multiProjectSearch";return g+"/rest/api/latest/user/assignable/"+e},query:!0,minQueryLength:0,data:a,formatResponse:l}},t),"-1"==t.editValue&&(t.editValue=!1,p.val("-1")),this._super(t),this.suggestionsHandler=new i(this.options,this.model)},requestSuggestions:function(e){return this._pagination.lastQuery!=this.getQueryVal()&&this._resetPagination(),this._super(e).done(l.bind(function(e){var t=u(e);if(t){var i=t.items();i&&i.length&&(this._pagination.numberOfShowingItems+=i.length)}return e},this))},scrolledToBottomHandler:function(){this._pagination.requestNextPagePromise&&!this._pagination.requestNextPagePromise.isResolved()||this._pagination.allResultsDisplayed||(this._pagination.requestNextPagePromise=this.requestSuggestions(!0).done(l.bind(function(e){var t=u(e);if(t){var i=t.items();i&&i.length?(this.listController.appendToGroupDescriptor("assignee-group-search",i),this.listController.addNextPage()):this._pagination.allResultsDisplayed=!0}else this._pagination.allResultsDisplayed=!0},this)))},_handleCharacterInput:function(e){this._pagination.lastQuery!=this.getQueryVal()?this._super(e):e&&this.showSuggestions()},handleFreeInput:function(e){""===o.trim(e||this.$field.val())?this.setSelection(this.model.getDescriptor("-1")):this._super(e),this._resetPagination()},cleanUpModel:function(){},_resetPagination:function(){this._pagination.lastQuery=this.getQueryVal(),this._pagination.numberOfShowingItems=0,this._pagination.allResultsDisplayed=!1,this._pagination.requestNextPagePromise=null}})}),AJS.namespace("JIRA.AssigneePicker",null,require("jira/field/assignee-picker"));