define("jira/admin/custom-fields/user-picker-filter/selector-panel",["underscore","jquery"],function(e,t){AJS.namespace("JIRA.Admin.CustomFields.UserPickerFilter");var r=JIRA.Templates.Admin.CustomFields.UserPickerFilter;return{initialize:function(e,t,r,i){this.$selectorPanel=e,this._initData(t,i),this._renderSelectorPanel(this._userFilter,r,i),this._setupEventHandlers()},getUserFilter:function(){return this._copyUserFilter(this._userFilter)},isUserFilterEnabled:function(){return this._userFilter.enabled},getFilterCheckbox:function(){return this._getElement("#filter-checkbox")},_userFilter:{},_projectRolesIdMap:{},_numOfEntries:0,_entryRenderers:{group:function(e){return r.showGroupFilterEntry({name:e,seq:this._numOfEntries++})},role:function(e){var t=this._projectRolesIdMap[e];return t&&t.name?r.showRoleFilterEntry({name:t.name,seq:this._numOfEntries++,roleId:e}):""}},_jsonUpdaters:{add:{group:function(e){return!(t.inArray(e,this._userFilter.groups)>-1)&&(this._userFilter.groups.push(e),!0)},role:function(e){var r=parseInt(e,10);return!(isNaN(r)||t.inArray(r,this._userFilter.roleIds)>-1)&&(this._userFilter.roleIds.push(r),!0)}},remove:{group:function(e){var r=t.inArray(e,this._userFilter.groups);return r>-1&&(this._userFilter.groups.splice(r,1),!0)},role:function(e){var r=parseInt(e,10);if(isNaN(r))return!1;var i=t.inArray(r,this._userFilter.roleIds);return i>-1&&(this._userFilter.roleIds.splice(i,1),!0)}}},_getElement:function(e){return this.$selectorPanel.find(e)},_initData:function(t,r){this._userFilter=this._copyUserFilter(e.extend(this._getDefaultUserFilter(),t)),this._projectRolesIdMap=this._populateRoleDetailsMap(r)},_renderSelectorPanel:function(e,t,i){this.$selectorPanel.append(r.renderSelectorPanel({groups:t,projectRoles:i,userFilter:e})),this._renderInitEntries()},_setupEventHandlers:function(){var e=this;this.getFilterCheckbox().change(function(){var r=t(this);e._userFilter.enabled=r.is(":checked"),e._updateUIForEnabledChange()}),this._getTypeSelector().change(function(){var t=e._getCurrentSelector();e._getElement(".filter-selector").not(t).hide(),e._getElement(t).show()}),this._getAddFilterIcon().click(function(){var t=e._getSelectedType(),r=e._getSelectedValue();e._updateJson(t,"add",r)&&e._renderEntry(t,r)}),this._getDisplayDiv().on("click",".delete-filter",function(){var r=t(this),i=r.closest(".filter-entry"),n=i.data("type"),s=i.data("value");e._updateJson(n,"remove",s)&&(i.remove(),0==--e._numOfEntries&&e._updateUIForNoFilterEntriesMsg())})},_copyUserFilter:function(e){var t={enabled:e.enabled,groups:[],roleIds:[]};return t.enabled&&(e.groups&&(t.groups=e.groups.slice()),e.roleIds&&(t.roleIds=e.roleIds.slice())),t},_updateJson:function(e,t,r){var i=this._jsonUpdaters[t];if(i){var n=i[e];if(n&&"function"==typeof n)return n.call(this,r)}return!1},_getDefaultUserFilter:function(){return{enabled:!1,groups:[],roleIds:[]}},_getDisplayDiv:function(){return this._getElement("#filter-display-div")},_addToDisplay:function(e){e&&this._getDisplayDiv().append(e)},_getNoFilterEntryDiv:function(){return this._getElement("#filter-entry-div-none")},_getNoFilterWarningDiv:function(){return this._getElement("#filter-none-msg")},_renderEntry:function(e,t){var r=this._entryRenderers[e];r&&"function"==typeof r&&(this._addToDisplay(r.call(this,t)),1===this._numOfEntries&&this._updateUIForNoFilterEntriesMsg())},_populateRoleDetailsMap:function(e){var r={};return t.each(e,function(e,t){r[t.id]=t}),r},_renderInitEntries:function(){var e=this;this._userFilter.enabled?(this._userFilter.groups&&t.each(this._userFilter.groups,function(t,r){e._renderEntry("group",r)}),this._userFilter.roleIds&&t.each(this._userFilter.roleIds,function(t,r){e._renderEntry("role",r)})):this._userFilter=this._getDefaultUserFilter(),this._updateUIForEnabledChange()},_updateUIForEnabledChange:function(){var e=this._userFilter.enabled,t=this._getElement("#filter-selector-selection-panel"),r=this._getElement("#filter-disabled-msg");e?(t.show(),r.hide()):(t.hide(),r.show()),this._updateUIForNoFilterEntriesMsg()},_updateUIForNoFilterEntriesMsg:function(){0===this._numOfEntries&&this._userFilter.enabled?(this._getNoFilterEntryDiv().show(),this._getNoFilterWarningDiv().show()):(this._getNoFilterEntryDiv().hide(),this._getNoFilterWarningDiv().hide())},_getTypeSelector:function(){return this._getElement("#filter-selector-type")},_getGroupSelector:function(){return this._getElement("#filter-selector-group")},_getRoleSelector:function(){return this._getElement("#filter-selector-role")},_getAddFilterIcon:function(){return this._getElement("#add-filter")},_getSelectedType:function(){return this._getTypeSelector().find("option:selected").val()},_getSelectedValue:function(){return this._getElement(this._getCurrentSelector()).find("option:selected").val()},_getCurrentSelector:function(){return"#filter-selector-"+this._getSelectedType()}}}),AJS.namespace("JIRA.Admin.CustomFields.UserPickerFilter.SelectorPanel",null,require("jira/admin/custom-fields/user-picker-filter/selector-panel"));