define("jira/share/util",[],function(){"use strict";function e(e,t){var i=document.getElementById(t),r=document.getElementById(e);i&&r&&(i.style.display="none",r.style.display="")}return{toggleElements:e}}),define("jira/share/i18n",["jira/util/strings","exports"],function(e,t){"use strict";t.getMessage=function(e){return this[e]?this[e]:"unknown"},t._formatMessage=function(e,t,i){for(var r,s,n=0;n<i.length;n++)for(s=String(i[n]),t&&(s=t(s)),r=new RegExp("\\{"+n+"\\}","g");e.search(r)>=0;)e=e.replace(r,s);return e},t.formatMessage=function(i){var r=Array.prototype.slice.call(arguments,1);return t._formatMessage(i,e.escapeHtml,r)},t.formatMessageUnescaped=function(e){var i=Array.prototype.slice.call(arguments,1);return t._formatMessage(e,null,i)}}),define("jira/share/controllers/edit-shares-controller",["aui/message","jira/share/i18n","jira/jquery/plugins/isdirty","jquery"],function(e,t,i,r){"use strict";function s(e){this.shares=new Array,this.displayDiv=document.getElementById("share_display_div"),this.emptyDiv=document.getElementById("empty_share"),this.shareDiv=document.getElementById("share_div"),this.submitButtonId=e,this.shareTypes={},this.counter=0,this.singleton=!1,this.dirty=!1}return s.prototype={registerShareType:function(e){e&&e.type&&(this.shareTypes[String(e.type)]=e)},initialise:function(){var e,t,s,n,a=this;for(t in this.shareTypes)s=this.shareTypes[t],r("#share_add_"+s.type).click(function(e){return function(t){a.addShareCallback(t,e)}}(s)),s.initialise&&s.initialise(this.setDescription);var o,l=document.getElementById("share_type_hidden"),h=document.getElementById("shares_data");try{o=JSON.parse(h.firstChild.nodeValue),o instanceof Array||(o=[])}catch(e){o=[]}for(e=0;e<o.length;e++)if(void 0!==o[e].type&&(s=this.shareTypes[o[e].type])){var c=s.getDisplayFromPermission(o[e]);c&&this.addDisplay(c)}if(0===this.shares.length){var p=this.emptyDiv.cloneNode(!0);p.removeAttribute("id"),p.style.display="",this.displayDiv.appendChild(p)}this.recalculateHiddenValue(),l.defaultValue=l.value,r(l).addClass(i.ClassNames.SANCTIONED),n=document.getElementById("share_busy"),n&&(n.style.display="none",n.parentNode&&n.parentNode.removeChild(n)),this.shareDiv.style.display="",r("#share_type_selector").change(function(e){a.selectShareTypeCallback(e)});var u=document.getElementById("share_type_selector"),d=u.options,g=d[u.selectedIndex].value;document.getElementById("share_"+g).style.display="";var y=this.shareTypes[g];this.setDescription(y.getDisplayDescriptionFromUI()),this.setWarning(y.getDisplayWarning()),this.submitButtonId&&r("#"+this.submitButtonId).click(function(e){a.saveCallback(e)})},addDisplay:function(e){var i=this;if(e){var s=this.findShare(e.permission);if(s>=0)return void this.animateShare(s);var n=this.counter++,a=null;if(e.singleton){if(0!==this.shares.length){var o=t.getMessage("common.sharing.remove.shares.public");"loggedin"==e&&(o=t.getMessage("common.sharing.remove.shares.authenticated"));if(!confirm(o))return}a=this.clearDiv()}else this.singleton?a=this.clearDiv():0===this.shares.length&&(a=this.clearDiv());if(a)for(;a.firstChild;)a.removeChild(a.firstChild);else a=document.createElement("DIV");a.className="shareItem",a.id="share_div_"+n;var l=document.createElement("DIV");l.id="share_div_"+n+"_inner",l.title=e.description;var h=this.cloneImage("share_icon");h&&l.appendChild(h);var c=document.createElement("SPAN");c.innerHTML=e.display,l.appendChild(c);var p=this.cloneImage("share_trash");p&&(r(p).click(function(e){i.removeCallback(e,n)}),l.appendChild(p)),a.appendChild(l),this.singleton=e.singleton,this.displayDiv.appendChild(a),this.shares.push({id:n,permission:e.permission}),this.recalculateHiddenValue()}},cloneImage:function(e){var t=document.getElementById(e);return t&&(t=t.cloneNode(!0),t.removeAttribute("id"),t.style.display=""),t},findShare:function(e){for(var t=0;t<this.shares.length;t++)if(e.equals(this.shares[t].permission))return this.shares[t].id;return-1},selectShareTypeCallback:function(){for(var e,t=document.getElementById("share_type_selector"),i=t.options,r=0;r<i.length;r++){var s=document.getElementById("share_"+i[r].value);s&&(r==t.selectedIndex?e=s:s.style.display="none")}e.style.display="";var n=i[t.selectedIndex].value,a=this.shareTypes[n];this.setDescription(a.getDisplayDescriptionFromUI()),this.setWarning(a.getDisplayWarning()),this.dirty=!0},saveCallback:function(e){if(this.dirty){var i=this.getCurrentShareType();if(i){var r=i.getDisplayFromUI();r&&r.permission&&this.findShare(r.permission)<0&&(confirm(t.getMessage("common.sharing.dirty.warning"))||e.preventDefault())}}},addShareCallback:function(e,t){this.addDisplay(t.getDisplayFromUI())},removeCallback:function(e,t){this.remove(t)},remove:function(e){for(var t=0;t<this.shares.length;t++)if(this.shares[t].id==e){this.shares.splice(t,1);break}var i=document.getElementById("share_div_"+e);this.shares.length>=1?this.displayDiv.removeChild(i):(i.innerHTML=this.emptyDiv.innerHTML,i.className=this.emptyDiv.className,i.removeAttribute("id")),this.recalculateHiddenValue()},clearDiv:function(){this.shares=new Array;for(var e=null;!e&&this.displayDiv.firstChild;)"div"==this.displayDiv.firstChild.nodeName.toLowerCase()?e=this.displayDiv.firstChild:this.displayDiv.removeChild(this.displayDiv.firstChild);if(e)for(;e.nextSibling;)this.displayDiv.removeChild(e.nextSibling);return e},setDescription:function(e){var t=document.getElementById("share_type_description");t&&(t.innerHTML=e)},setWarning:function(t){var i=document.getElementById("share_warning");i&&(t.length>0?e.warning("#share_warning",{body:t,closeable:!1,shadowed:!1}):i.innerHTML="")},recalculateHiddenValue:function(){var e=document.getElementById("share_type_hidden");if(e){for(var t=[],i=0;i<this.shares.length;i++)t.push(this.shares[i].permission);e.value=JSON.stringify(t)}},animateShare:function(e){var t=document.getElementById("share_div_"+e+"_inner");if(t){for(var i=t.parentNode,s=null;!s&&i&&i!=document.body.parentNode;)i.style&&(s=i.style.backgroundColor),!s&&i.bgColor&&(s=i.bgColor),i=i.parentNode;s||(s="#FFFFFF"),r(t).hasClass("fading")||(r(t).addClass("fading"),r(t).css({backgroundColor:"#FFCCCC"}).animate({backgroundColor:"#FFFFFF"},2e3,function(){r(t).removeClass("fading")}))}},getCurrentShareType:function(){var e=document.getElementById("share_type_selector");return e?this.shareTypes[e.options[e.selectedIndex].value]:null}},s}),define("jira/share/controllers/select-single-share-type-controller",["jquery"],function(e){"use strict";function t(){this.shares=new Array,this.shareTypes={},this.singleton=!1}return t.prototype={registerShareType:function(e){e&&e.type&&(this.shareTypes[String(e.type)]=e)},initialise:function(){var t,i,r=this;for(t in this.shareTypes)i=this.shareTypes[t],i.initialise&&i.initialise(this.setDescription);var s,n=document.getElementById("shares_data");try{var a=n.firstChild.nodeValue;s=JSON.parse(a),s instanceof Array||(s=[])}catch(e){s=[]}var o=null,l=null;0===s.length?(o="any",i=this.shareTypes[o],l=null):(o=s[0].type,i=this.shareTypes[o],l=s[0]),i.updateSelectionFromPermission&&i.updateSelectionFromPermission(l);var h=document.getElementById("share_type_selector");h&&(this.updateShareTypeSelectorList(h,o),this.setDescription(i.getDisplayDescriptionFromUI()),e(h).change(function(e){r.selectShareTypeCallback(e)}));var c=document.getElementById("share_busy");c&&(c.style.display="none",c.parentNode&&c.parentNode.removeChild(c)),(c=document.getElementById("share_div"))&&(c.style.display="")},updateShareTypeSelectorList:function(e,t){for(var i=e.options,r=0,s=0;s<i.length;s++){var n=i[s].value;n==t&&(r=s),document.getElementById("share_"+n).style.display="none"}i[r].selected=!0;var a=document.getElementById("share_"+i[r].value);a&&(a.style.display="")},selectShareTypeCallback:function(){for(var e,t=document.getElementById("share_type_selector"),i=t.options,r=0;r<i.length;r++){var s=document.getElementById("share_"+i[r].value);s&&(r==t.selectedIndex?e=s:s.style.display="none")}e.style.display="";var n=i[t.selectedIndex].value,a=this.shareTypes[n];this.setDescription(a.getDisplayDescriptionFromUI())},setDescription:function(e){var t=document.getElementById("share_type_description");t&&(t.innerHTML=e)},setWarning:function(e){var t=document.getElementById("share_warning");t&&(e.length>0?(t.className="aui-message warning",t.innerHTML=e):(t.className="",t.innerHTML=""))}},t}),define("jira/share/entities/share-type/global-share",["jira/share/entities/display","jira/share/entities/share-permission","jira/share/i18n"],function(e,t,i){"use strict";function r(){this.type="global",this.singleton=!0}return r.prototype={getDisplayFromUI:function(){var r=new t(this.type,null,null),s=i.getMessage("share_global_display");return new e(s,this.getDisplayDescriptionFromUI(),this.singleton,r)},getDisplayDescriptionFromUI:function(){return i.getMessage("share_global_description")},getDisplayFromPermission:function(r){if(!r||r.type!=this.type)return null;var s=new t(this.type,null,null),n=i.getMessage("share_global_display");return new e(n,this.getDisplayDescriptionFromUI(),this.singleton,s)},getDisplayWarning:function(){return i.getMessage("share_global_warning")}},r}),define("jira/share/entities/share-type/authenticated-user-share",["jira/share/entities/display","jira/share/entities/share-permission","jira/share/i18n"],function(e,t,i){"use strict";function r(){this.type="loggedin",this.singleton=!0}return r.prototype={getDisplayFromUI:function(){var r=new t(this.type,null,null),s=i.getMessage("share_authenticated_display");return new e(s,this.getDisplayDescriptionFromUI(),this.singleton,r)},getDisplayDescriptionFromUI:function(){return i.getMessage("share_authenticated_description")},getDisplayFromPermission:function(r){if(!r||r.type!=this.type)return null;var s=new t(this.type,null,null),n=i.getMessage("share_authenticated_display");return new e(n,this.getDisplayDescriptionFromUI(),this.singleton,s)},getDisplayWarning:function(){return""}},r}),define("jira/share/entities/share-type/group-share",["jira/share/entities/display","jira/share/entities/share-permission","jira/share/i18n","jquery"],function(e,t,i,r){"use strict";function s(){this.type="group",this.singleton=!1}return s.prototype={initialise:function(e){var t=this;this.setDescription=e,this.groupSelect=document.getElementById("groupShare"),this.groupSelect&&r(this.groupSelect).change(function(e){t.groupChangeCallback(e)})},getDisplayFromUI:function(){if(this.groupSelect){var i=this.groupSelect.options[this.groupSelect.selectedIndex].value,r=new t(this.type,i,null);return new e(this.getDisplayString(i),this.getDescriptionString(i,!0),this.singleton,r)}},getDisplayDescriptionFromUI:function(){if(!this.groupSelect)return"";var e=this.groupSelect.options[this.groupSelect.selectedIndex].value;return this.getDescriptionString(e,!1)},getDisplayFromPermission:function(i){if(!i||i.type!=this.type||!i.param1)return null;var r=new t(this.type,i.param1,null);return new e(this.getDisplayString(r.param1),this.getDescriptionString(i.param1,!0),this.singleton,r)},getDisplayString:function(e){var t=i.getMessage("share_group_display");return i.formatMessage(t,e)},getDescriptionString:function(e,t){var r=i.getMessage("share_group_description");return t?i.formatMessageUnescaped(r,e):i.formatMessage(r,e)},updateSelectionFromPermission:function(e){if(this.groupSelect)for(var t=e.param1,i=this.groupSelect.options,r=0;r<i.length;r++)i[r].value==t&&(i[r].selected=!0)},groupChangeCallback:function(){this.setDescription&&this.setDescription(this.getDisplayDescriptionFromUI())},getDisplayWarning:function(){return""}},s}),define("jira/share/entities/share-type/project-share",["jira/share/entities/display","jira/share/entities/share-permission","jira/share/i18n","jquery"],function(e,t,i,r){"use strict";function s(){this.roleMap={},this.projectMap={},this.type="project",this.singleton=!1}return s.prototype={initialise:function(e){var t=this;if(this.setDescription=e,this.projectSelect=document.getElementById("projectShare-project"),this.roleSelect=document.getElementById("projectShare-role"),this.roleSelectGroup=document.getElementById("projectShare-role-group"),this.roleSelect&&this.projectSelect&&this.roleSelectGroup){var i,s;for(s=1;s<this.roleSelect.options.length;s++)i=this.roleSelect.options[s],this.roleMap[i.value]=i.text;for(s=0;s<this.projectSelect.options.length;s++)i=this.projectSelect.options[s],this.projectMap[i.value]=i.text;this.setRoles(),r(this.projectSelect).change(function(e){t.changeCallbackForProject(e)}),r(this.roleSelect).change(function(e){t.updateDescription(e)})}},getDisplayFromUI:function(){if(this.projectSelect&&this.roleSelect){var r,s=this.projectSelect.options[this.projectSelect.selectedIndex],n=s.value,a=s.text,o=this.roleSelect.options[this.roleSelect.selectedIndex],l=o.value,h=o.text;""==l?(r=i.getMessage("share_project_display_all"),r=i.formatMessage(r,a)):(r=i.getMessage("share_project_display"),r=i.formatMessage(r,a,h));var c=new t(this.type,n,l);return new e(r,this.getDescriptionString(a,l,h,!0),this.singleton,c)}},getDisplayDescriptionFromUI:function(){if(!this.projectSelect||!this.roleSelect)return"";var e=this.projectSelect.options[this.projectSelect.selectedIndex],t=e.text,i=this.roleSelect.options[this.roleSelect.selectedIndex],r=i.value,s=i.text;return this.getDescriptionString(t,r,s,!1)},getDescriptionString:function(e,t,r,s){var n;return t&&""!=t?(n=i.getMessage("share_role_description"),n=s?i.formatMessageUnescaped(n,r,e):i.formatMessage(n,r,e)):(t=null,n=i.getMessage("share_project_description"),n=s?i.formatMessageUnescaped(n,e):i.formatMessage(n,e)),n},getDisplayFromPermission:function(r){var s,n,a,o,l;return r&&r.type==this.type&&r.param1?(r.param2?(o=this.getProject(r.param1),l=this.getRole(r.param2),s=i.getMessage("share_project_display"),s=i.formatMessage(s,o,l),n=new t(this.type,r.param1,r.param2),a=this.getDescriptionString(o,r.param2,l,!0)):(o=this.getProject(r.param1),s=i.getMessage("share_project_display_all"),s=i.formatMessage(s,o),n=new t(this.type,r.param1,null),a=this.getDescriptionString(o,null,null,!0)),new e(s,a,this.singleton,n)):null},getDisplayWarning:function(){return""},changeCallbackForProject:function(){this.setRoles(),this.updateDescription()},updateDescription:function(){this.setDescription&&this.setDescription(this.getDisplayDescriptionFromUI())},setProject:function(e){if(this.projectSelect)for(var t=this.projectSelect.options,i=0;i<t.length;i++)t[i].value==e&&(t[i].selected=!0)},setRoles:function(e){if(this.projectSelect&&this.roleSelect&&this.roleSelectGroup){var t,i=this.projectSelect.options[this.projectSelect.selectedIndex],r=i.getAttribute("roles");if(r)try{t=JSON.parse(r),t||(t=[])}catch(e){t=[]}else t=[];this.roleSelectGroup.parentNode&&(this.roleSelect.removeChild(this.roleSelectGroup),this.roleSelectGroup=this.roleSelectGroup.cloneNode(!1));var s=null;if(t.length>0){for(var n=0;n<t.length;n++){var a=document.createElement("OPTION");a.appendChild(document.createTextNode(this.roleMap[t[n]]));var o=t[n];a.value=o,o==e&&(s=a),this.roleSelectGroup.appendChild(a)}this.roleSelect.appendChild(this.roleSelectGroup)}s&&(s.selected=!0)}},getProject:function(e){var t=this.projectMap[e];return t||(t=i.getMessage("share_invalid_project"))||(t="[Invalid Project]"),t},getRole:function(e){var t=this.roleMap[e];return t||(t=i.getMessage("share_invalid_role"))||(t="[Invalid Role]"),t},updateSelectionFromPermission:function(e){this.setProject(e.param1),this.setRoles(e.param2)}},s}),define("jira/share/entities/share-type/any-share",["jira/share/i18n"],function(e){"use strict";function t(){this.type="any",this.singleton=!0}return t.prototype={getDisplayDescriptionFromUI:function(){return e.getMessage("share_any_description")}},t}),define("jira/share/entities/display",[],function(){"use strict";function e(e,t,i,r){this.display=e,this.singleton=i,this.permission=r,this.description=t}return e}),define("jira/share/entities/share-permission",[],function(){"use strict";function e(e,t,i){this.type=e,t&&(this.param1=t),i&&(this.param2=i)}return e.prototype.equals=function(e){return this.type===e.type&&this.param1===e.param1&&this.param2===e.param2},e}),define("jira/share/share-factory",["jira/share/controllers/edit-shares-controller","jira/share/controllers/select-single-share-type-controller","jira/share/entities/share-type/authenticated-user-share","jira/share/entities/share-type/project-share","jira/share/entities/share-type/global-share","jira/share/entities/share-type/group-share","jira/share/entities/share-type/any-share","jquery"],function(e,t,i,r,s,n,a,o){"use strict";function l(t){var a=new e(t);a.registerShareType(new s),a.registerShareType(new i),a.registerShareType(new n),a.registerShareType(new r),o(document).ready(function(){a.initialise()})}function h(){var e=new t;e.registerShareType(new a),e.registerShareType(new n),e.registerShareType(new r),o(document).ready(function(){e.initialise()})}return{registerEditShareTypes:l,registerSelectShareTypes:h}}),AJS.namespace("JIRA.Share.i18n",null,require("jira/share/i18n")),AJS.namespace("JIRA.Share.toggleElements",null,require("jira/share/util").toggleElements),AJS.namespace("JIRA.Share.SharePermission",null,require("jira/share/entities/share-permission")),AJS.namespace("JIRA.Share.Display",null,require("jira/share/entities/display")),AJS.namespace("JIRA.Share.AnyShare",null,require("jira/share/entities/share-type/any-share")),AJS.namespace("JIRA.Share.GroupShare",null,require("jira/share/entities/share-type/group-share")),AJS.namespace("JIRA.Share.GlobalShare",null,require("jira/share/entities/share-type/global-share")),AJS.namespace("JIRA.Share.ProjectShare",null,require("jira/share/entities/share-type/project-share")),AJS.namespace("JIRA.Share.AuthenticatedUserShare",null,require("jira/share/entities/share-type/authenticated-user-share")),AJS.namespace("JIRA.Share.SelectSingleShareTypeController",null,require("jira/share/controllers/select-single-share-type-controller")),AJS.namespace("JIRA.Share.EditSharesController",null,require("jira/share/controllers/edit-shares-controller")),AJS.namespace("JIRA.Share.registerEditShareTypes",null,require("jira/share/share-factory").registerEditShareTypes),AJS.namespace("JIRA.Share.registerSelectShareTypes",null,require("jira/share/share-factory").registerSelectShareTypes),AJS.namespace("atlassian.jira.share",window,window.JIRA.Share);