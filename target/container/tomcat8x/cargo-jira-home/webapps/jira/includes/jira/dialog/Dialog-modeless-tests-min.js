AJS.test.require(["jira.webresources:jira-global","jira.webresources:dialogs","com.atlassian.auiplugin:dialog2"],function(){var t,o,e=require("jquery"),i=require("underscore"),n=require("jira/dialog/dialog"),a=AJS.Dialog,d=AJS.dialog2,s=AJS.dim,u=[],r=function(t,o,e){e.forEach(function(e){test(AJS.format.apply(this,[t].concat(e.context)),function(){o.apply(this,e.parameters)})})};module("Modeless Dialog Tests",{setup:function(){t=document.title,o=E("modeless dialog",{modeless:!0})},teardown:function(){document.title=t,q()}}),test("Should show",function(){o.show(),v(o),m(o),y(A(o))}),test("Should hide",function(){o.show(),o.hide(),k(o),y(t)}),test('Should not change window title when windowTitle is "false"',function(){E("modeless dialog",{modeless:!0,windowTitle:!1}).show(),y(t)}),test("JIRA Dialog should be modal by default",function(){var t=E("jira dialog");t.show(),w(t)}),test('JIRA Dialog should be modal when specified "modeless: false"',function(){var t=E("jira dialog",{modeless:!1});t.show(),w(t)}),function(){var t=[{parameters:[function(){return E("jira stacked dialog")}],context:["jira dialog"]},{parameters:[function(){return J("aui stacked dialog",1)}],context:["aui dialog"]},{parameters:[function(){return D("aui stacked dialog2",1)}],context:["aui dialog2"]}];r('Should hide when stacked "{0}" is shown',function(t){var e=t();c(o),c(e),h(e)},t),r('Should show when stacked "{0}" is hidden',function(t){var e=t();c(o,e),l(e),f(o)},t)}(),function(){var t=[{parameters:[function(){return E("jira stacked dialog 1")},function(){return E("jira stacked dialog 2")}],context:["jira dialog","jira dialog"]}],e=function(t,o){return{bottom:t(),top:o()}};r('Should stay hidden when stacked "{0}" is shown on top of stacked "{1}"',function(t,i){var n=e(t,i);c(o,n.bottom),c(n.top),h(n.top)},t),r('Should stay hidden when top stacked "{1}" is hidden on top of stacked "{0}"',function(t,i){var n=e(t,i);c(o,n.bottom,n.top),l(n.top),h(n.bottom)},t),r('Should show when the bottom stacked "{0}" get hidden together with the top stacked "{1}"',function(t,i){var n=e(t,i);c(o,n.bottom,n.top),l(n.top),l(n.bottom),f(o)},t)}(),function(){var t=[{parameters:[function(){return D("aui stacked dialog2 1",1)},function(){return D("aui stacked dialog2 2",2)}],context:["aui dialog2","aui dialog2"]},{parameters:[function(){return J("aui stacked dialog 1",1)},function(){return D("aui stacked dialog2 2",2)}],context:["aui dialog","aui dialog2"]},{parameters:[function(){return D("aui stacked dialog2 1",1)},function(){return J("aui stacked dialog 2",2)}],context:["aui dialog2","aui dialog"]}],e=function(t,o){return{bottom:t(),top:o()}};r('Should stay hidden when stacked "{0}" is shown on top of stacked "{1}"',function(t,i){var n=e(t,i);c(o,n.bottom),c(n.top),h(n.top,[o])},t),r('Should stay hidden when top stacked "{1}" is hidden on top of stacked "{0}"',function(t,i){var n=e(t,i);c(o,n.bottom,n.top),l(n.top),p(n.bottom)},t),r('Should show when the bottom stacked "{0}" get hidden together with the top stacked "{1}"',function(t,i){var n=e(t,i);c(o,n.bottom,n.top),l(n.top),l(n.bottom),f(o)},t)}();var c=function(){for(var t=0;t<arguments.length;t++)arguments[t].show()},l=function(){for(var t=0;t<arguments.length;t++)arguments[t].hide()},h=function(t,o){g(t,o,!0)},f=function(t,o){g(t,o,!1)},p=function(t,o){g(t,o,void 0)},g=function(t,o,e){void 0===o&&(o=i.difference(u,t)),v(t),S(o),"boolean"===e&&j(e)},m=function(t){b(t,"modeless")},w=function(t){b(t,"modal")},b=function(t,o){o="modal"!==o,strictEqual(t.isModeless(),!!o,A(t)+" should "+(o?"":"not ")+"be modeless")},v=function(t){x(t,!0)},k=function(t){x(t,!1)},S=function(t){t.forEach(function(t){k(t)})},x=function(t,o){var e;"function"==typeof t.isVisible?e=t.isVisible():t instanceof a&&(e=!!AJS.popup.current&&AJS.popup.current.element===t.popup.element),strictEqual(e,!!o,A(t)+" should "+(o?"":"not ")+"be visible")},j=function(t){var o=s&&s.$dim&&"false"===s.$dim.attr("aria-hidden");strictEqual(!!o,!!t,"blanket should "+(t?"":"not ")+"be visible")},y=function(t){strictEqual(document.title,t,"window title should be equal "+t)},A=function(t){return t.options&&t.options.windowTitle||t.get&&t.get("header")&&t.get("header")[0].text()||t.$el&&t.$el.find("header").text()||"n/a"},q=function(){u.reverse().forEach(function(t){t.hide()}),u=[],e("."+n.ClassNames.DIALOG).remove(),e(".aui-dialog2").remove(),e(".aui-dialog").remove()},E=function(t,o){var i=e("<div>").css({height:"200px"}).append(e("<h2>").text(t)),a={content:function(t){return t(i)},stacked:!0,height:"200px",windowTitle:t},d=new n(e.extend(a,o));return d.isVisible=function(){return i.is(":visible")&&"hidden"!==i.css("visibility")},d.isModeless=function(){return this.get$popup().hasClass(n.ClassNames.MODELESS_DIALOG)},u.push(d),d},J=function(t,o){var e={width:800,height:500,id:"dialog-name"+o,closeOnOutsideClick:!0,stacked:!0},i=new a(e);return i.addHeader(t||"some header"),u.push(i),i},D=function(t,o){var i={width:800,height:500,id:"dialog2-name"+o,closeOnOutsideClick:!0},n='<section role="dialog" id="'+i.id+'" class="aui-layer aui-dialog2 aui-dialog2-medium" aria-hidden="true">             \x3c!-- Dialog header --\x3e             <header class="aui-dialog2-header">'+t+"</header>             <p>Hello World</p>         </section>";e(document.body).append(n);var a=d("#"+i.id);return u.push(a),a}});