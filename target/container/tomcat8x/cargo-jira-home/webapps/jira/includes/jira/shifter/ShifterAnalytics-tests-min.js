AJS.test.require(["jira.webresources:shifter"],function(){function e(e){return{name:"jira.dotdialog.selection",data:n.extend({lang:"en"},e)}}var l,t=require("jira/shifter/shifter-analytics"),a=require("jira/util/data/meta"),i=require("jira/analytics"),n=require("underscore"),o=sinon.assert,s=sinon.match,d={setup:function(){this.sandbox=sinon.sandbox.create(),this.sandbox.stub(a,"get").returns("en"),l=this.sandbox.stub(i,"send")},teardown:function(){this.sandbox.restore()}};module("ShifterAnalytics#show",d),test("should trigger an event",function(){t.show(),o.calledOnce(l),o.calledWith(l,{name:"jira.dotdialog.show",data:void 0})}),module("ShifterAnalytics#selection",d),test("shouldn't trigger if there are not enough parameters",function(){t.selection(),t.selection("label"),t.selection("label","value"),t.selection("label","value","group-id"),o.calledOnce(l),o.calledWith(l,s.has("name","jira.dotdialog.selection"))}),test("should hash labels that are potentially user-entered",function(){t.selection("label","value","group-id"),o.calledOnce(l),o.calledWith(l,e({group:"group-id",selected:"102727412"}))}),test("shouldn't hash values in white-listed groups",function(){n.each(t.selection.privacyPolicySafeGroups,function(a){t.selection("label","value",a),o.calledWith(l,e({group:a,selected:"label"}))}),o.calledTwice(l)}),test("shouldn't hash white-listed values",function(){n.each(t.selection.privacyPolicySafeLabels,function(a){t.selection(a,"value","group-id"),o.calledWith(l,e({group:"group-id",selected:a}))}),o.callCount(l,8)}),test('should use values and not labels for system fields in "edit-fields" group',function(){t.selection("label","value","edit-fields"),o.calledOnce(l),o.calledWith(l,e({group:"edit-fields",selected:"value"}))}),test('should hash custom fields in "edit-fields" group',function(){t.selection("label","customfield_123","edit-fields"),o.calledOnce(l),o.calledWith(l,e({group:"edit-fields",selected:"102727412"}))}),test("Should extract language from the locale",function(){a.get.returns("te_ST"),t.selection("label","value","group"),o.calledOnce(l),o.calledWith(l,{name:"jira.dotdialog.selection",data:{lang:"te",group:"group",selected:"102727412"}})}),test("Should use default language if something is wrong with the locale",function(){a.get.returns("wrong"),t.selection("label","value","group"),o.calledOnce(l),o.calledWith(l,{name:"jira.dotdialog.selection",data:{lang:"en",group:"group",selected:"102727412"}})}),test("Should use default language if there is no locale",function(){a.get.returns(void 0),t.selection("label","value","group"),o.calledOnce(l),o.calledWith(l,{name:"jira.dotdialog.selection",data:{lang:"en",group:"group",selected:"102727412"}})})});