require(["jira/util/urls","jira/util/formatter","wrm/context-path","jira/jquery/deferred","jquery","underscore","jira/ajs/ajax/smart-ajax","jira/shifter"],function(e,s,t,r,i,n,a,o){o.register(function(){function o(e){for(var s=0;s<e.length;s++){var t=n.reduce(e[s].split("."),function(e,s){return void 0!==e?e[s]:void 0},window);if(n.isFunction(t)){var r=t();if(null!=r)return r}}}var u=r(),l=r(),c=o(["JIRA.Issues.getSelectedIssueKey","JIRA.Issue.getIssueKey","JIRA.IssueNavigator.getSelectedIssueKey"]),I=o(["JIRA.Issues.getSelectedIssueKey","JIRA.Issue.getIssueId","JIRA.IssueNavigator.getSelectedIssueId"]);if(null==I)return null;var d=s.format(t()+"/rest/api/1.0/issues/{0}/ActionsAndOperations?atl_token={1}",I,e.atl_token());a.makeRequest({dataType:"json",url:d}).done(function(e){var s=n.map(e.operations,function(e){return{label:e.name,value:{styleClass:e.styleClass,url:e.url}}}),r=n.map(e.actions,function(s){var r=t()+"/secure/WorkflowUIDispatcher.jspa?id="+e.id+"&action="+s.action+"&atl_token="+e.atlToken;return{label:s.name,value:{styleClass:"issueaction-workflow-transition",url:r}}});u.resolve(s),l.resolve(r)}).fail(function(e,t){var r;r=JIRA&&JIRA.Templates&&JIRA.Templates.ViewIssue&&JIRA.Templates.ViewIssue.Body&&JIRA.Templates.ViewIssue.Body.errorsLoading?JIRA.Templates.ViewIssue.Body.errorsLoading({isTimeout:"timeout"===t}):s.I18n.getText("issuepicker.find.issue.error"),u.resolve([{label:r,messageID:"error-loading-issue",useAUI:!1,isMessage:!0}]),l.reject()});var g=function(e,s){var t=i("<a>",{text:s,class:e.styleClass,href:e.url,css:{display:"none"}});t.appendTo("body").get(0).click(),t.remove()};return[{id:"issue-actions",name:s.I18n.getText("shifter.group.issueactions"),context:c,weight:200,getSuggestions:function(){return u},onSelection:g},{id:"issue-transitions",name:s.I18n.getText("opsbar.more.transitions"),context:c,weight:220,getSuggestions:function(){return l},onSelection:g}]})});