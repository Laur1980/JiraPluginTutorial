AJS.test.require("jira.webresources:jira-setup",function(){var e=require("jquery"),t=require("underscore"),s=require("jira/setup/setup-database-view"),r=function(e,t){return{selected:!!t,text:e,value:e}},n={errors:{},databaseOptions:{},externalDatabases:[r("mssql",!0),r("mysql"),r("oracle10g"),r("postgres72")],helpPaths:{migration:"migtation.url",external:"external.url"},fieldValues:{}},i=JIRA.Templates.Setup.layoutContent({content:JIRA.Templates.Setup.Database.pageContents(t.extend({globalErrors:[]},n))});module("JIRA Db Select page tests",{setup:function(){this.sandbox=sinon.sandbox.create({useFakeServer:!0}),e("#qunit-fixture").append(e("<div></div>").addClass("jira-setup-database-page").html(i)),this.initializeView=function(){this.view=new s({el:".jira-setup-database-page"})}},teardown:function(){this.sandbox.restore(),this.view.remove()}}),test("Error messages are displayed in the notifications area",function(){this.initializeView(),this.view.testConnection(),this.sandbox.server.requests[0].respond(200,{"Content-Type":"application/json"},JSON.stringify({data:t.extend({dbTestSuccessful:!1,databaseMessagesContent:[],globalErrors:["errorFoo","errorBar"]},n)})),deepEqual(t.map(this.view.ui.errorMessages.children(),function(t){return e(t).html()}),["errorFoo","errorBar"],"Errors are displayed on the page"),equal(0,this.view.ui.successMessages.length,"Success message is not displayed.")}),test("DB fields are hidden and shown on changing db type.",function(){this.initializeView();var s=this.view.ui.dbType,r=function(t){s.val(t),s.children().removeAttr("selected").filter(function(s,r){return e(r).html()==t}).attr("selected",""),s.trigger("change")},n=function(t,s){equal(AJS.$(".db-type-"+t).filter(function(t,r){return!e(r).hasClass("db-type-"+s)}).filter(function(t,s){return!e(s).hasClass("hidden")}).length,0,"Should hide all "+t+" specific fields."),equal(AJS.$(".db-type-"+s).filter(function(t,s){return e(s).hasClass("hidden")}).length,0,"None of the "+s+" should be hidden.")};t.each(function(e,s){var r=e;return t.map(s,function(e){var t={oldDb:r,newDb:e};return r=e,t})}("mssql",["mysql","oracle10g","postgres72"]),function(e){r(e.newDb),n(e.oldDb,e.newDb)})})});