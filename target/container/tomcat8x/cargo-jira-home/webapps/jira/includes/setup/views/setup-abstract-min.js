define("jira/setup/setup-abstract-view",["jira/util/key-code","marionette","jquery","underscore"],function(e,t,i,o){var a={choiceBox:".jira-setup-choice-box",choiceValueField:"#jira-setup-choice-value",form:".jira-setup-form",submitButton:".jira-setup-form-submit"},c={"click @ui.choiceBox":"onChoiceBoxClick","submit @ui.form":"onSubmit","keydown @ui.choiceBox":"onChoiceBoxKeyDown"};return t.Layout.extend({choiceActiveClassname:"jira-setup-choice-box-active",constructor:function(e,i){var n=this.initialize;this.ui=o.extend({},this.ui,a),this.events=o.extend({},this.events,c),"function"==typeof n&&(this.initialize=function(){if(this.bindUIElements(),this.delegateEvents(),this._pageData=this._readPageDataFromStorage(),this.ui.choiceBox.length){var e=this.ui.choiceValueField.val();e?this.selectChoiceBox(e):this.selectFirstChoiceBox()}n.apply(this,arguments)}),t.ItemView.apply(this,arguments)},selectChoiceBox:function(e){var t=this.ui.choiceBox.filter("[data-choice-value='"+e+"']");t.length&&this._handleChoiceBoxSelection(t)},selectFirstChoiceBox:function(){this._handleChoiceBoxSelection(this.ui.choiceBox.eq(0))},_handleChoiceBoxSelection:function(e){var t=e.data("choice-value");this.ui.choiceBox.removeClass(this.choiceActiveClassname),this.ui.choiceBox.removeAttr("tabindex"),e.addClass(this.choiceActiveClassname),e.attr("tabindex","0"),e.focus(),this.ui.choiceValueField.val(t),this.ui.submitButton.enable(),this.onChoiceBoxValueChange(e)},onChoiceBoxClick:function(e){var t=i(e.currentTarget);this._handleChoiceBoxSelection(t)},_handleChoiceBoxToggleByKeyboard:function(t){var o=i();t.keyCode===e.DOWN?(t.preventDefault(),o=i(t.target).next(".jira-setup-choice-box")):t.keyCode===e.UP&&(t.preventDefault(),o=i(t.target).prev(".jira-setup-choice-box")),1==o.length&&this._handleChoiceBoxSelection(o)},onChoiceBoxValueChange:function(e){this.updatePageDataKey("choiceBoxValue",e.data("choice-value"))},_sendFormByPressingEnterOnChoiceBox:function(e){e.preventDefault(),i(e.target).parent("form").find("input[type=submit]").click()},onChoiceBoxKeyDown:function(t){t.keyCode===e.ENTER?this._sendFormByPressingEnterOnChoiceBox(t):this._handleChoiceBoxToggleByKeyboard(t)},updatePageDataKey:function(e,t){this._pageData[e]=t,this.pageStorageKey&&window.sessionStorage.setItem(this.pageStorageKey,JSON.stringify(this._pageData))},getPageData:function(){return this._pageData},getPageDataKey:function(e){return this._pageData[e]},_readPageDataFromStorage:function(){return this.pageStorageKey?JSON.parse(window.sessionStorage.getItem(this.pageStorageKey)||"{}"):{}}})});