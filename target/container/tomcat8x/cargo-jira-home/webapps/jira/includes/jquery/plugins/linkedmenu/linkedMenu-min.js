!function(e){e.deactivateLinkedMenu=function(){},e.linkedMenuInstances=[],e.fn.linkedMenu=function(n){var o,u,s=this,t=!1,i=function(n){n=e(n),s.blur(),n.trigger("click","focus","mousedown")},c=function(e){var n;37!==e.keyCode&&39!==e.keyCode&&27!==e.keyCode||(37===e.keyCode?(n=o-1,o-1>=0?r(s[n])&&(o=n,i(s[o])):(n=s.length-1,r(s[n])&&(o=n,i(s[o])))):39===e.keyCode?(n=o+1,n<s.length?r(s[n])&&(o=n,i(s[o])):(n=0,r(s[n])&&(o=n,i(s[o])))):s.disableLinkedMenu(e),e.preventDefault())},r=function(e){if(e!==s[o])return!0},d=function(){r(this)&&(o=e.inArray(this,s),i(this))},l=function(){var u=e.inArray(this,e(n.reflectFocus));r(s[u])&&(o=u,i(s[o]))},a=function(){var i,r;t||(e.currentLinkedMenu=s,n.onFocusRemoveClass&&(i=e(n.onFocusRemoveClass),(r=n.onFocusRemoveClass.match(/\.([a-z]*)$/))&&r[1]&&i.length>0&&(e(n.onFocusRemoveClass).removeClass(r[1]),u=function(){e(i).addClass(r[1])})),t=!0,o=e.inArray(this,s),s.mouseover(d),e.browser.mozilla?e(document).keypress(c):e(document).keydown(c),e(document).mousedown(s.disableLinkedMenu),n.reflectFocus&&e(n.reflectFocus).mouseover(l))};return s.disableLinkedMenu=function(o){e(document).unbind("keypress",c),e(document).unbind("keydown",c),s.unbind("mouseover",d),e(document).unbind("mousedown",arguments.callee),n.reflectFocus&&e(n.reflectFocus).unbind("mouseover",l),u&&u(),s.blur(),delete e.currentLinkedMenu,window.setTimeout(function(){t=!1},200)},n=n||{},i=n.focusElement||i,s.click(a),s}}(jQuery);