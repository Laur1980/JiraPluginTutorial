AJS.test.require(["jira.webresources:jira-global"],function(){function t(){return i("<form action='javascript:void(0)'></form>").appendTo("body")}function e(){for(var t=i("<form/>").appendTo("body"),e=0,a=arguments.length;e<a;e++)t.append(arguments[e]);return t}var i=require("jquery"),a=require("jira/jquery/plugins/isdirty");module("Dirty Forms",{teardown:function(){i("form").remove()}}),test("An empty form cannot be dirty",function(){var e=t(),i=e.isDirty();equal(i,!1,"Empty form cannot be dirty")}),test("A form with class 'ajs-dirty-warning-exempt' cannot be dirty, even if it has dirty fields",function(){var e=t();e.addClass("ajs-dirty-warning-exempt"),e.find("input").val("another value");var i=e.isDirty();equal(i,!1,"Form with class 'ajs-dirty-warning-exempt' cannot be dirty")}),test("A form can be rendered as dirty by default",function(){var t=e("<input type='text' name='valid' value=''>");t.addClass("ajs-dirty-warning-by-default"),equal(t.isDirty(),!0,"Form should be dirty if specific class was added")}),test("The form of an input with class 'ajs-dirty-warning-exempt' cannot be dirty",function(){var t=e("<input type='text' name='input1' value='someValue'>"),i=t.find("input").addClass("ajs-dirty-warning-exempt");i.val("another value");var a=i.isDirty();equal(a,!1,"Form with an element with class 'ajs-dirty-warning-exempt' cannot be dirty")}),test("The form of an input with class 'ajs-dirty-warning-exempt' is dirty if it contains a dirty field without the class 'ajs-dirty-warning-exempt'",function(){var t=e("<input type='text' name='cleanInput' value='someValue'><input type='text' name='dirtyInput' value='anotherValue'/>");t.find("input[name=cleanInput]").addClass("ajs-dirty-warning-exempt"),t.find("input[name=dirtyInput]").val("changed value");var i=t.isDirty();equal(i,!0,"A form containing a clean field with excempt class and a dirty field without exempt class is dirty.")}),test("A clean field is clean even if its form contains a dirty field",function(){var t=e("<input type='text' name='cleanInput' value='someValue'><input type='text' name='dirtyInput' value='anotherValue'/>"),i=t.find("input[name=cleanInput]");t.find("input[name=dirtyInput]").val("changed value");var a=i.isDirty();equal(a,!1,"A clean field is clean even if its form contains a dirty field")}),test("A form containing a dirty, but invisible, field is not dirty",function(){var t=i("<input style='display:none' type='text' name='dirtyHiddenField' value='someValue'>"),a=e(t);t.val("changed value");var n=a.isDirty();equal(n,!1,"A form containing a dirty, but invisible, field is not dirty")}),test("A form containing a dirty, invisible, but sanctioned element is dirty",function(){var t=i("<input style='display:none' type='text' name='dirtyHiddenField' value='someValue'>"),n=e(t);t.addClass(a.ClassNames.SANCTIONED),t.val("changed value");var r=n.isDirty();equal(r,!0,"A form containing a dirty, invisible, but sanctioned field is dirty")}),test("Hidden form elements never have default values, so are always clean",function(){var t="changed value",n=i("<input type='hidden' name='hiddenInputField' value='someValue'>"),r=n.clone(!0),l=e(n,r);equal(n[0].defaultValue,"someValue","The default value is currently set to the old value"),n.val(t),r.addClass(a.ClassNames.SANCTIONED),r.val(t);var d=l.isDirty();equal(d,!1,"The form shouldn't be dirty"),equal(n[0].value,t,"The value of the hidden field was set correctly"),notEqual(n[0].defaultValue,"someValue","The default value should not remain the same, since hidden fields have no defaultValue"),equal(n[0].defaultValue,t,"The default value was updated as per the DOM specification"),equal(r[0].defaultValue,t,"Even sanctioning a hidden field won't help -- this is DOM behaviour, after all.")}),test("A form containing a dirty button is not dirty",function(){var t=e("<input type='button' name='dirtyHiddenField' value='someValue'>");t.find("input[name=dirtyHiddenField]").val("changed value");var i=t.isDirty();equal(i,!1,"A form containing a dirty, button is not dirty")}),test("A form containing a dirty select is dirty",function(){var t=e("<select name='dirtySelect'><option>Option 1</option><option selected='selected'>Option 2</option><option>Option 3</option></select>");t.find("select").val("Option 3");var i=t.isDirty();equal(i,!0,"A form containing a dirty select is dirty")}),test("A form containing a dirty multi-select is dirty",function(){var t=e("<select multiple='multiple' name='dirtySelect'><option selected='selected'>Option 1</option><option selected='selected'>Option 2</option><option>Option 3</option></select>");t.find("select").val("Option 3");var i=t.isDirty();equal(i,!0,"A form containing a dirty multi-select is dirty")}),test("A form containing a dirty radio button is dirty",function(){var t=e("<input type='radio' name='radiogroup' value='initialValue2' checked='checked'><input type='radio' name='radiogroup' value='initialValue2'>");t.find("input").last().prop("checked",!0);var i=t.isDirty();equal(i,!0,"A form containing a dirty radio button is dirty")}),test("A form containing a dirty checkbox is dirty",function(){var t=e("<input type='checkbox' name='checkgroup' value='initialValue'>");t.find("input").prop("checked",!0);var i=t.isDirty();equal(i,!0,"A form containing a dirty checkbox is dirty")}),test("A form with unchanged inputs is clean",function(){var t=e("<input type='text' name='input1' value='someValue'><input type='text' name='input2' value='someValue'>"),i=t.isDirty();equal(i,!1,"A form with clean inputs is clean")}),test("A form containing an unchanged textarea is clean",function(){var t=e("<textarea name='textarea1'>this is the defaultValue</textarea>"),i=t.isDirty();equal(i,!1,"A form with a clean textarea is clean")}),test("A form containing a changed textarea is dirty",function(){var t=e("<textarea name='textarea1'>this is the defaultValue</textarea>");t.find("textarea").val("dirty value");var i=t.isDirty();equal(i,!0,"A form with a dirty textarea is dirty")}),test("A form containing a changed text input is dirty",function(){var t=e("<input type='text' value='this is the defaultValue' name='input1'/>");t.find("input").val("dirty value");var i=t.isDirty();equal(i,!0,"A form with a dirty text input is dirty")})});