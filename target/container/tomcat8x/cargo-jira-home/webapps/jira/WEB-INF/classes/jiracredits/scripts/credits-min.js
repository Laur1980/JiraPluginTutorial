define("jira-credits-game",["require"],function(e){"use strict";var t=e("jquery"),n=e("jira-credits-contributor-blob"),i=e("jira-credits-web-action-properties"),o={width:32,height:14},r={width:92,height:92},a={VERTICAL:5,HORIZONTAL:6},s={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"},d={keybindKey:"keydown.credits.global",clickbindKey:"click.credits.global",soundOn:!0,init:function(){d.addKeyBinding(),d.addClickBinding(),d.render(d.SCREEN.HOME),d.showMenu()},deinit:function(){d.Game.deinit(),d.List.deinit(),d.Home.deinit(),t(document).unbind(d.keybindKey).unbind(d.clickbindKey),d.soundOn=!1,setTimeout(function(){d=null},1)},addKeyBinding:function(){t(document).on(d.keybindKey,null,"0",d.Game.goToUser("Robert J Chatfield")).on(d.keybindKey,null,"1",d.Game.goToUser("Kerrod Williams")).on(d.keybindKey,null,"2",d.Game.goToUser("Daniel Kerris"))},addClickBinding:function(){t(document).on(d.clickbindKey,".jira-credits-sound-button",function(){d.soundOn=!d.soundOn,d.play("turnOn"),d.soundOn?t(".jira-credits-sound-button").removeClass("jira-credits-sound-button-off"):t(".jira-credits-sound-button").addClass("jira-credits-sound-button-off")})},showMenu:function(){t("#jira-credits-home-loading").hide(),t("#jira-credits-home-menu").show()},play:function(e){if(d.shouldDeinit(),d.soundOn){var t=d.Sound[e];t.readyState>0&&(t.currentTime=0,t.play())}},shouldDeinit:function(){0===t("#jira-credits-container").length&&d.deinit()},calcScrollingState:function(e,t,n,i,o,r,a){var s=o,d=r,c=2*r,u=a-2*r,l=a-r,f=a-o,m=a-1,b=r-1,h=o,y=r-o;switch(e){case"+":return t>=m?{absolute:m,rangeOffset:-1*l,cursor:b}:t>=f?{absolute:t+1,rangeOffset:-1*l,cursor:i+1}:i>=y?{absolute:t+1,rangeOffset:n-1,cursor:i}:{absolute:t+1,rangeOffset:n,cursor:i+1};case"-":return t<=0?{absolute:0,rangeOffset:0,cursor:0}:t<=s?{absolute:t-1,rangeOffset:0,cursor:t-1}:i<h?{absolute:t-1,rangeOffset:n+1,cursor:i}:{absolute:t-1,rangeOffset:n,cursor:i-1};case"++":return t>=l?{absolute:a-1,rangeOffset:-1*(a-r),cursor:r-1}:t>=u?{absolute:a-(r-i),rangeOffset:-1*(a-r),cursor:i}:{absolute:t+r,rangeOffset:n-r,cursor:i};case"--":return t<=d?{absolute:0,rangeOffset:0,cursor:0}:t<=c?{absolute:t+n,rangeOffset:0,cursor:t+n}:{absolute:t-r,rangeOffset:n+r,cursor:i};default:return console.log("wat"),{absolute:0,rangeOffset:0,cursor:0}}},render:function(e){var n=t("#jira-credits-list"),i=t("#jira-credits-game"),o=t("#jira-credits-home");switch(n.css("display","none"),i.css("display","none"),o.css("display","none"),d.List.deinit(),d.Game.deinit(),d.Home.deinit(),e){case d.SCREEN.LIST:return d.List.init(),n.css("display","inline-block"),void d.play("turnOn");case d.SCREEN.GAME:return d.Game.init(),i.css("display","inline-block"),void d.play("turnOn");default:return d.Home.init(),o.css("display","inline-block"),void d.play("turnOff")}}};d.SCREEN={HOME:"home",LIST:"list",GAME:"game"},d.Data={contributorBlob:n,pad:function(e){var t=e+"";return t.length>=4?e:new Array(4-t.length+1).join("0")+t},offsetPos:function(e){return{x:Math.floor(2*e.x/32),y:Math.floor(2*e.y/32)}}},d.Data.coords={},d.Data.contributorIds=[];for(var c in d.Data.contributorBlob)if(d.Data.contributorBlob.hasOwnProperty(c)){var u=d.Data.contributorBlob[c],l=d.Data.offsetPos(u);d.Data.coords[d.Data.pad(l.x)+d.Data.pad(l.y)]=c,"???"!==u.name&&d.Data.contributorIds.push(c)}return d.Data.contributorIds.sort(),d.Home={keybindKey:"keydown.credits.home",clickbindKey:"click.credits.home",selected:d.SCREEN.GAME,init:function(){d.Home.addKeyBindings(),d.Home.addClickBindings(),d.Home.render()},deinit:function(){t(document).unbind(d.Home.keybindKey).unbind(d.Home.clickbindKey)},addKeyBindings:function(){function e(e){return function(n){t(document).on(d.Home.keybindKey,null,n,function(t){t.preventDefault(),e()})}}["up","down","w","s"].forEach(e(function(){d.Home.selected=d.Home.selected===d.SCREEN.GAME?d.SCREEN.LIST:d.SCREEN.GAME,d.Home.render(),d.play("select2")})),["return","space"].forEach(e(function(){d.render(d.Home.selected)}))},addClickBindings:function(){function e(e,n){t(document).on(d.Home.clickbindKey,e,function(){d.Home.selected=n,d.Home.render(),d.render(n)})}e("#jira-credits-home-button-game",d.SCREEN.GAME),e("#jira-credits-home-button-list",d.SCREEN.LIST)},render:function(){var e=t("#jira-credits-home-button-game"),n=t("#jira-credits-home-button-list"),i="jira-credits-row-item-selected";switch(d.Home.selected){case d.SCREEN.GAME:return e.addClass(i),void n.removeClass(i);case d.SCREEN.LIST:return e.removeClass(i),void n.addClass(i);default:return e.removeClass(i),void n.removeClass(i)}}},d.Game={keybindKey:"keydown.credits.game",clickbindKey:"click.credits.game",mousemoveBindKey:"mousemove.credits.game",absolutePoint:{x:void 0,y:void 0},boardPoint:{x:void 0,y:void 0},cursorPoint:{x:void 0,y:void 0},init:function(){t("#jira-credits-board").css("width",32*r.width+"px").css("height",32*r.height+"px"),d.Game.addKeyBindings(),d.Game.addMouseBinding(),void 0===d.Game.absolutePoint.x&&d.Game.setAbsolutePosition(r.width/2,r.height/2)},deinit:function(){t(document).unbind(d.Game.keybindKey).unbind(d.Game.mousemoveBindKey)},addKeyBindings:function(){var e=t(document),n={up:s.UP,down:s.DOWN,left:s.LEFT,right:s.RIGHT,w:s.UP,s:s.DOWN,a:s.LEFT,d:s.RIGHT};for(var i in n)n.hasOwnProperty(i)&&function(t,n){e.on(d.Game.keybindKey,null,t,function(e){d.Game.triggerHandler(e,n)})}(i,n[i]);["l"].forEach(function(t){e.on(d.Game.keybindKey,null,t,function(){d.render(d.SCREEN.LIST)})}),["q"].forEach(function(t){e.on(d.Game.keybindKey,null,t,function(){d.render(d.SCREEN.HOME)})})},addMouseBinding:function(){t("#jira-credits-board-container").on(d.Game.mousemoveBindKey,function(e){var t=e.pageX-this.offsetParent.offsetParent.offsetLeft,n=e.pageY-this.offsetTop-this.offsetParent.offsetParent.offsetTop,i={x:Math.floor(t/32)-d.Game.boardPoint.x,y:Math.floor(n/32)-d.Game.boardPoint.y-2},o=d.Game.getContributor(i)||d.Game.getContributor(d.Game.absolutePoint);d.Game.renderContributor(o)}),t(document).on(d.Game.clickbindKey,".jira-credits-back-button",function(){d.render(d.SCREEN.HOME)})},triggerHandler:function(e,t){e.preventDefault(),d.Game.scrollInDirection(t)},setAbsolutePosition:function(e,t){e>=r.width-1&&(e=r.width-1),t>=r.height-1&&(t=r.height-1),d.Game.absolutePoint.x=e,d.Game.absolutePoint.y=t,e<o.width/2?(d.Game.boardPoint.x=0,d.Game.cursorPoint.x=e):e>r.width-o.width/2?(d.Game.boardPoint.x=-1*(r.width-o.width),d.Game.cursorPoint.x=e+d.Game.boardPoint.x):(d.Game.boardPoint.x=-1*(e-o.width/2),d.Game.cursorPoint.x=o.width/2),t<o.height/2?(d.Game.boardPoint.y=0,d.Game.cursorPoint.y=t):t>r.height-o.height/2?(d.Game.boardPoint.y=-1*(r.height-o.height),d.Game.cursorPoint.y=t+d.Game.boardPoint.y):(d.Game.boardPoint.y=-1*(t-o.height/2),d.Game.cursorPoint.y=o.height/2),d.Game.render()},goToUser:function(e){return function(){var t=d.Data.offsetPos(d.Data.contributorBlob[e]);d.Game.setAbsolutePosition(t.x,t.y)}},scrollInDirection:function(e){if(d.play("select2"),e===s.LEFT||e===s.RIGHT){var t=d.calcScrollingState(e===s.LEFT?"-":"+",d.Game.absolutePoint.x,d.Game.boardPoint.x,d.Game.cursorPoint.x,a.HORIZONTAL,o.width,r.width);d.Game.absolutePoint.x=t.absolute,d.Game.boardPoint.x=t.rangeOffset,d.Game.cursorPoint.x=t.cursor}else if(e===s.UP||e===s.DOWN){var n=d.calcScrollingState(e===s.UP?"-":"+",d.Game.absolutePoint.y,d.Game.boardPoint.y,d.Game.cursorPoint.y,a.VERTICAL,o.height,r.height);d.Game.absolutePoint.y=n.absolute,d.Game.boardPoint.y=n.rangeOffset,d.Game.cursorPoint.y=n.cursor}d.Game.render()},getContributor:function(e){var t=d.Data.pad(e.x),n=d.Data.pad(e.y),i=t+n,o=d.Data.coords[i];return d.Data.contributorBlob[o]},render:function(){d.Game.renderOffset("#jira-credits-board",32*d.Game.boardPoint.x,32*d.Game.boardPoint.y),d.Game.renderOffset("#jira-credits-cursor",32*d.Game.cursorPoint.x,32*d.Game.cursorPoint.y);var e=d.Game.getContributor(d.Game.absolutePoint);d.Game.renderContributor(e)},renderOffset:function(e,n,i){var o=["translate(",n,"px,",i,"px)"].join("");t(e).css("transform",o)},renderContributor:function(e){e?(t("#jira-credits-name").html(e.name+" - "),t("#jira-credits-desc").html(e.role)):(t("#jira-credits-name").html(""),t("#jira-credits-desc").html(""),t("#jira-credits-level").html(""))}},d.List={keybindKey:"keydown.credits.list",clickbindKey:"click.credits.list",viewportRange:8,scrollPadding:2,absolute:0,rangeOffset:0,cursor:0,init:function(){d.List.addKeyBindings(),d.List.render()},deinit:function(){t(document).unbind(d.List.keybindKey).unbind(d.List.clickbindKey)},addKeyBindings:function(){function e(e){return function(t){o.on(d.List.keybindKey,null,t,function(t){t.preventDefault(),e()})}}function n(t){return e(function(){var e=d.calcScrollingState(t,d.List.absolute,d.List.rangeOffset,d.List.cursor,d.List.scrollPadding,d.List.viewportRange,d.Data.contributorIds.length);d.List.absolute===e.absolute||d.play("select2"),d.List.absolute=e.absolute,d.List.rangeOffset=e.rangeOffset,d.List.cursor=e.cursor,d.List.render()})}function i(e){var t=d.Data.contributorIds[e],n=d.Data.contributorBlob[t],i=d.Data.offsetPos(n);d.render(d.SCREEN.GAME),d.Game.setAbsolutePosition(i.x,i.y)}var o=t(document);["up","w"].forEach(n("-")),["down","s"].forEach(n("+")),["pageup"].forEach(n("--")),["pagedown"].forEach(n("++")),["return","space"].forEach(e(function(){i(d.List.cursor-d.List.rangeOffset)})),o.on(d.List.clickbindKey,".jira-credits-list-row-item",function(){i(t(this).data("row-index"))}),o.on(d.List.clickbindKey,".jira-credits-back-button",function(){d.render(d.SCREEN.HOME)}),["q"].forEach(function(e){t(document).on(d.List.keybindKey,null,e,function(){d.render(d.SCREEN.HOME)})})},render:function(){for(var e=["<tr>","<th></th>","<th>Name</th>","<th>Role</th>","</tr>"],n=0-d.List.rangeOffset,o=d.List.viewportRange-d.List.rangeOffset,r=n;r<o;r++){var a=d.Data.contributorIds[r],s=d.Data.contributorBlob[a];if(void 0===s)break;e.push('<tr data-row-index="'+r+'" class="jira-credits-list-row-item jira-credits-row-item jira-credits-clickable'),r===d.List.cursor-d.List.rangeOffset&&e.push(" jira-credits-row-item-selected"),e.push('">','<td class="jira-credits-arrow"><img src="'+i.cursorURL+'" alt="select"></td>',"<td>",s.name,"</td>","<td>",s.role,"</td>","</tr>")}t("#jira-credits-list-rows").html(e.join(""))}},d.Sound=i.sounds,d});